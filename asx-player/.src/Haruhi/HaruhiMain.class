' Gambas class file

Private $xml As XmlDocument
Private $stream As Process

Private Function getPathWithDialog() As String
    
    Dialog.Path = User.Home
    Dialog.Filter = ["*.asx", "asx file"]
    
    If Dialog.OpenFile(False) Then Return ""
    
    Return Dialog.Path
    
End

Private Function getPath() As String
    
    If MikuruArgs.Paths.Count > 0 Then
        Return MikuruArgs.Paths[0]
    Else
        Return getPathWithDialog()
    Endif
    
End

Private Sub play() 

    Dim yukiXmlElements As XmlElement[]
    Dim yukiFilePath As String = getPath()
    Dim yukiPath As String

    If yukiFilePath = "" Then Return 

    $xml = New XmlDocument(yukiFilePath)
    yukiXmlElements = $xml.GetElementsByTagName("REF")

    yukiPath = yukiXmlElements[0].Attributes["HREF"]

    If yukiPath Begins "mms://" Then $stream = Exec ["mplayer", yukiPath]

End

Public Sub Form_Show()

    play()

End


Public Sub Form_Close()

    Try $stream.Kill()

End
