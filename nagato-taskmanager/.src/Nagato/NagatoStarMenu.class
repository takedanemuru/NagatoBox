' Gambas class file

Inherits NagatoSignal

Public Enum MenuNone, MenuUnselect, MenuKill, MenuAbout, MenuQuit

Private $rootMenu As Menu

Private Sub initializeRootMenu(argButton As MenuButton)
    
    $rootMenu = New Menu(HaruhiMain) As "RootMenu"
    
    $rootMenu.Name = "RootMenu"
    argButton.Menu = $rootMenu.Name
    
End

Private Sub addMenuItem(argText As String, argTag As Integer, Optional argIcon As String)
    
    Dim yukiMenu As New Menu($rootMenu) As "ChildMenu"
    
    With yukiMenu
        .Text = argText
        .Tag = argTag
        If argIcon Then .Picture = MikuruIcon.Get(argIcon)
    End With
    
End

Private Sub initializeChildMenus()

    If HaruhiMain.IsSelected Then
        addMenuItem(("Unselect"), MenuUnselect)
        addMenuItem(("Kill selected process"), MenuKill, "exclamation")
            addMenuItem((""), MenuNone)
    End If
    addMenuItem(("About nagato-taskmanager"), MenuAbout, "star")
    addMenuItem(("Quit"), MenuQuit, "button-power")
    
End

Public Sub _new(argButton As MenuButton)
    
    initializeRootMenu(argButton)
    initializeChildMenus()
    
End

Public Sub RootMenu_Show()
    
    $rootMenu.Children.Clear()
    
    initializeChildMenus()
    
End

Public Sub ChildMenu_Click()
    
    Raise Signal(Last.Tag, [""])
    
End
