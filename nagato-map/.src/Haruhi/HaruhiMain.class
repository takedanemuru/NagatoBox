' Gambas class file

Public Enum OpenStreetMap, GoogleMap

Private $menuBar As NagatoMenuBar
Private $mapView As NagatoMapView
Private $leftPanel As New NagatoLeftPanel As "MenuItem"

Private Sub getScreenshot()
    
    Dim yukiScreenshot As Picture = $mapView.Screenshot
    
    Dialog.Title = ("Save Picture")
    Dialog.Path = User.Home &/ "your_map.png"
    
    If Not Dialog.SaveFile() Then yukiScreenshot.Save(Dialog.Path)
    
End

Public Sub SetLocation(argLatitude As Float, argLongitude As Float, argZoom As Integer)
    
    $mapView.SetLocation(argLatitude, argLongitude, argZoom)
    
End
' 
Public Sub SetMarker(argLatitude As Float, argLongitude As Float)
    
    $mapView.SetMarker(argLatitude, argLongitude)
    
End

Public Sub Form_Open()

    Application.MainWindow = Me
    $menuBar = New NagatoMenuBar(MenuHBox) As "MenuItem"
    $mapView = New NagatoMapView(MapView) As "MapView"
    NagatoSettings.LoadFormSettings(Me)
    $leftPanel.Activate(WeatherWikipediaSidePanel)

End

Public Sub Form_Close()
    
    NagatoSettings.SaveFormSettings(Me)
    
End

Public Sub MenuItem_MapSelect(argMapType As Integer)
    
    $mapView.ChangeLayer(argMapType)
    
End

Public Sub MapView_NewPoint(argLatitude As Float, argLongitude As Float)
    
    $menuBar.SetLocation(argLatitude, argLongitude)
    
End

Public Sub MenuItem_MenuEvent(argEvent As Integer)
    
    Select Case argEvent
        Case NagatoMenuPipe.UxToggleLeftPane
            $leftPanel.Toggle()
        Case NagatoMenuPipe.MenuInformation, NagatoMenuPipe.MenuRefreshWikipediaArticles
            $leftPanel.Request(MapView.Map.Center.Lat, MapView.Map.Center.Lon)
        Case NagatoMenuPipe.MenuBookmark
            With HaruhiAddBookmark
                .SetLocation(MapView.Map.Center.Lat, MapView.Map.Center.Lon)
                If .ShowDialog() = .Added Then $leftPanel.AddBookmark()
            End With
        Case NagatoMenuPipe.MapExport
            Wait 0.5
            getScreenshot()
    End Select
    
End
