' Gambas class file

Public Enum OpenStreetMap, GoogleMap

Private $menuBar As NagatoMenuBar
Private $mapView As NagatoMapView
Private $leftPanel As NagatoLeftPanel 

Public Sub SetLocation(argLatitude As Float, argLongitude As Float, argZoom As Integer)
    
    $mapView.SetLocation(argLatitude, argLongitude, argZoom)
    
End
' 
Public Sub SetMarker(argLatitude As Float, argLongitude As Float)
    
    $mapView.SetMarker(argLatitude, argLongitude)
    
End

Public Sub Form_Open()

    Application.MainWindow = Me
    NagatoSettings.LoadFormSettings(Me)

    $menuBar = New NagatoMenuBar(MenuHBox) As "TFEI"
    $leftPanel = New NagatoLeftPanel(MainHBox) As "TFEI"
    $mapView = New NagatoMapView(MainHBox) As "TFEI"

End

Public Sub Form_Close()
    
    NagatoSettings.SaveFormSettings(Me)
    
End

Public Sub TFEI_Signal(argSignal As Integer, argValues As Variant[])
    
    If argSignal = NagatoMenuPipe.MapSelect Then
        $mapView.ChangeLayer(argValues[0])
    End If
    
End

Public Sub TFEI_MenuEvent(argEvent As Integer)
    
    Select Case argEvent
        Case NagatoMenuPipe.UxToggleLeftPane
            $leftPanel.Toggle()
        Case NagatoMenuPipe.MenuInformation, NagatoMenuPipe.MenuRefreshWikipediaArticles
            $leftPanel.Request($mapView.MapPoint.Lat, $mapView.MapPoint.Lon)
        Case NagatoMenuPipe.MenuBookmark
            HaruhiAddBookmark.SetLocation($mapView.MapPoint.Lat, $mapView.MapPoint.Lon)
            If HaruhiAddBookmark.ShowDialog() = HaruhiAddBookmark.Added Then $leftPanel.AddBookmark()
        Case NagatoMenuPipe.MapExport
            Wait 0.5
            MikuruDialogScreenShot($mapView.Screenshot)
        Case NagatoMenuPipe.MapNewLocation
            $menuBar.SetLocation($mapView.MapPoint.Lat, $mapView.MapPoint.Lon)
    End Select
    
End
