' Gambas class file

Inherits NagatoDownloader

Property Read Cache As Collection
Property Ready As Boolean

Private $xmlDocument As New XmlDocument
Private $cache As New Collection
Private $ready As Boolean = False

Private Sub setAdditionalData(argWeatherElement As NagatoWeatherElement, argData As XmlElement[], argTimeStamp As String)
    
    If Not Object.IsValid(argWeatherElement) Then
        Return
    Else If Not argWeatherElement.HasIcon Then
        argWeatherElement.SetAdditionalData(argData)
    Else
        $cache.Add(argWeatherElement, argTimeStamp)
    End If 
    
End

Private Sub refresh()
    
    Dim yukiXmlElement As XmlElement
    Dim yukiWeatherElement As NagatoWeatherElement
    Dim yukiChildElements As XmlElement[]
    
    For Each yukiXmlElement In $xmlDocument.GetElementsByTagName("time")
        yukiChildElements = yukiXmlElement.ChildElements[0].ChildElements
        If yukiChildElements.Count > 2 Then
            yukiWeatherElement = New NagatoWeatherElement
            yukiWeatherElement.SetEssentialData(yukiChildElements)
        Else
            setAdditionalData(yukiWeatherElement, yukiChildElements, yukiXmlElement.Attributes["to"])
        Endif
    Next
    
    Debug Me._$buffer
    Debug $cache.Count
    
Catch
    Raise Error
    Return
    
End

Public Sub _SetData() ' override
    
    $xmlDocument.FromString(Me._$buffer)
    refresh()
    
End

Private Function Cache_Read() As Collection

    Return $cache

End

Private Function Ready_Read() As Boolean

    Return $ready

End

Private Sub Ready_Write(Value As Boolean)

    $ready = Value

End
