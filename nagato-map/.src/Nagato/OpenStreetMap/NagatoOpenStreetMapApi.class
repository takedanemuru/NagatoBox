' Gambas class file

Create Static

Private Const NominatimApi As String = "http://nominatim.openstreetmap.org/search?q=&1&format=xml"

Private $downloader As New NagatoDownloaderOpenStreetMap As "Downloader"

Event Finished(argXmlDocument As XmlDocument)

Public Sub Get(argQuery As String)
    
    $downloader.Get(Subst$(NominatimApi, Quote$(Replace$(argQuery, " ", "+"))))
    
End

Public Sub GetElements(argXmlDocument As XmlDocument) As Collection
    
    Dim yukiResult As New Collection
    Dim yukiNode As XmlNode
    Dim yukiGeoElement As NagatoGeoElement
    Dim yukiString As String = argXmlDocument.ToString(True)
    
    For Each yukiNode In argXmlDocument.GetElementsByTagName("searchresults")[0].AllChildNodes
        With yukiNode.Attributes
            Debug yukiNode.Children.Count ' DO NOT DELETE THIS LINE, to avoid bug.
            If .["display_name"] = "0" Then Continue ' avoid bug on gambas 3.6.0
            If .["display_name"] = "" Then Continue
            yukiGeoElement = New NagatoGeoElement(.["display_name"], .["lat"], .["lon"])
            yukiResult.Add(yukiGeoElement, .["display_name"])
        End With
    Next
    
    Return yukiResult
    
End

Public Sub Downloader_Finished()
    
    Raise Finished($downloader.XmlDocument)
    
End
