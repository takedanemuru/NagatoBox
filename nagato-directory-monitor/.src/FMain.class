' Gambas class file

Property Directory As String

Private $directory As String
Private $timer As New Timer As "Timer"
Private $lastObserved As Date
Private $previousPaths As String[]

Private Sub checkDeletedPath(argCurrentPaths As String[])
    
    Dim yukiPath As String
    
    If Object.IsValid($previousPaths) Then
        For Each yukiPath In $previousPaths
             If Not argCurrentPaths.Exist(yukiPath) Then
                 Debug "Deleted: " & yukiPath
             Endif
        Next
    Endif
    
End

Private Sub checkModefiedPath(argCurrentPaths As String[])
    
    Dim yukiPath As String
    
    For Each yukiPath In argCurrentPaths
        With Stat($directory &/ yukiPath)
            If 2 > DateDiff(.LastAccess, $lastObserved, gb.Second) Then
                Debug "Modefied: " & yukiPath
            End If
        End With
    Next
    
End

Public Sub _new()

    $directory = User.Home

End

Public Sub Form_Open()

    $lastObserved = Now
    $timer.Delay = 5000
    $timer.Start()

End

Public Sub Timer_Timer()
    
    Dim yukiCurrentPaths As String[] = Dir($directory)
    
    checkDeletedPath(yukiCurrentPaths)
    checkModefiedPath(yukiCurrentPaths)
    
    $lastObserved = Now
    $previousPaths = yukiCurrentPaths
    
End

Private Function Directory_Read() As String

    Return $directory

End

Private Sub Directory_Write(Value As String)

    $directory = Value

End
