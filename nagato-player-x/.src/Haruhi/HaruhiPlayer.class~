' Gambas class file

Property Read Settings As Settings

Private $settings As New Settings

Private $timer As New Timer As "Timer"
Private $painter As NagatoPainter
Private $surface As New NagatoSurface As "Surface"

Public Sub SetMessage(argMessage As String, argDuration As Integer) ' argDuration as Second
    
    $painter.SetMessage(argMessage, argDuration)
    
End

Public Sub Form_Open()
    
    Application.MainWindow = Me
    NagatoDBus.Register()
    
    NagatoSettingsForm.SetMainFormSize(Me)
    NagatoSettingsForm.SetPosition(Me)
    
    $timer.Enabled = True
    $painter = New NagatoPainter(DrawingArea)
    
    Debug "has picture : ";; NagatoQueue.ChannelCoverArt.Picture <> Null
    
End

Public Sub Form_Close()
    
    NagatoDBus.Unregister()
    NagatoSettingsForm.SavePosition(Me)
    
End

Public Sub Form_Drop()
    
    'Image data is NOT acceptable.
    If Drag.Type = Drag.Text Then $surface.Drop(Drag.Data)
    
End

Public Sub Timer_Timer()
    
    $painter.Refresh()
    
End

Public Sub DrawingArea_Enter()

    MikuruMousePosition.Entered = True
    
End

Public Sub DrawingArea_Leave()
    
    MikuruMousePosition.Entered = False
    
End

Public Sub DrawingArea_MouseMove()

    MikuruMousePosition.SetMousePosition(Mouse.X, Mouse.Y)
    $painter.Refresh()

End

Public Sub DrawingArea_MouseDown()

    $surface.MouseDown(Mouse.X, Mouse.Y)

End

Public Sub Surface_RequestRefresh()
    
    $painter.ChangeImage()
    
End

Private Function Settings_Read() As Settings

    Return $settings

End
