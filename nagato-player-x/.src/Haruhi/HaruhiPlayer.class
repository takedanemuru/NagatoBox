' Gambas class file

Private $painter As NagatoPainter
Private $observer As Observer

Public Sub Form_Open()
    
    Application.MainWindow = Me
    NagatoDBus.Register()
    
    NagatoSettingsForm.SetMainFormSize(Me)
    NagatoSettingsForm.SetPosition(Me)
    
    $painter = New NagatoPainter(DrawingArea)
    $observer = New Observer(NagatoBroadcast) As "Asakura"
    
End

Public Sub Form_Close()
    
    NagatoDBus.Unregister()
    NagatoSettingsForm.SavePosition(Me)
    
End

Public Sub Asakura_Broadcast(argSignal As Integer, argValues As Variant[])
    
    Select argSignal
        Case MikuruSignal.BroadcastIndexMoved
            Me.Title = NagatoQueue.GetProperty(MikuruProperty.CurrentTitle)
        Case MikuruSignal.BroadcastMessage
            $painter.SetMessage(argValues[0], argValues[1])
    End Select
    
    $painter.Refresh()
    
End
