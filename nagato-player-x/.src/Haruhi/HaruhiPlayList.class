' Gambas class file

Private $nowPlayingTab As NagatoTabQueue
Private $playlistsTab As NagatoTabPlaylists
Private $libraryTab As NagatoTabLibrary
Private $infoArea As NagatoInfoArea
Private $observer As Observer

Private Sub setSize()
    
    NagatoSettingsForm.SetSize(Me)
    If Not NagatoSettingsForm.Resizable Then Me.H = $infoArea.H
    
End

Public Sub _new()

    Me.Resizable = NagatoSettingsForm.Resizable
    NagatoSettingsForm.SetPosition(Me)

    $nowPlayingTab = New NagatoTabQueue(MenuPanelNowPlaying, NowPlayingGrid) As "NowPlayingTab"
    $playlistsTab = New NagatoTabPlaylists(MenuPanelPlaylists, PlaylistsGrid) As "PlaylistsGrids"
    $libraryTab = New NagatoTabLibrary(MenuPanelLibrary, LibraryGrid) As "LibraryGrids"
    $infoArea = New NagatoInfoArea(MainVBox)
    $observer = New Observer(NagatoBroadcast) As "Asakura"
    
    setSize()
    
End

Public Sub EnsureVisible()
    
    Dim yukiDesktopWindow As DesktopWindow
    
    yukiDesktopWindow = New DesktopWindow(Me.Id)
    yukiDesktopWindow.Desktop = Desktop.Current
    
    Me.Show()
    
End

Public Sub SetFormSize()
    
    Me.Resizable = NagatoSettingsForm.Resizable
    
    If NagatoSettingsForm.Resizable Then
        NagatoSettingsForm.SetSize(Me)
    Else
        Me.H = $infoArea.H
    Endif
    
End

Public Sub Form_Close()
    
    If NagatoSettingsForm.Main = NagatoSettingsForm.HPlayList Then NagatoDBus.Unregister()
    NagatoSettingsForm.SavePosition(Me)
    If NagatoSettingsForm.Resizable Then NagatoSettingsForm.SaveSize(Me)
    
End

Public Sub Form_Resize()
    
    If NagatoSettingsForm.Resizable Then NagatoSettingsForm.SaveSize(Me)
    
End

Public Sub Asakura_Broadcast(argSignal As Integer, argValues As Variant[])
    
    Select Case argSignal
        Case MikuruSignal.BroadcastTimer, MikuruSignal.BroadcastIndexMoved
            If Not Me.Closed Then $infoArea.Refresh()
        Case MikuruSignal.BroadcastPlaylistsChanged
            $playlistsTab.Refresh()
    End Select
    
    $nowPlayingTab(argSignal, argValues)
    
End
