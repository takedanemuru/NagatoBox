' Gambas class file

Private $coverArtPath As String
Private $observer As Observer
Private $element As NagatoMusicElement
Private $index As Integer
Private $handlerCoverArt As NagatoTagEditHandlerCoverArt

Private Sub setTags()
    
    TitleTextBox.Text = $element.Title
    ArtistTextBox.Text = $element.Artist
    AlbumTextBox.Text = $element.Album
    
End

Private Function getNewTag() As NagatoId3TagInfo
    
    Dim yukiTags As New NagatoId3TagInfo
    
    yukiTags.Title = TitleTextBox.Text
    yukiTags.Artist = ArtistTextBox.Text
    yukiTags.Album = AlbumTextBox.Text
    
    Return yukiTags
    
End

Public Sub EditByTagIndex(argIndex As Integer)
    
    $index = argIndex
    $element = NagatoQueue[argIndex]
    setTags()
    $handlerCoverArt.Reset($element.Path)
    ' AlbumArtPictureBox.Picture = MikuruEyeD3.GetPicture($element.Path, AlbumArtPictureBox.H)
    ' $coverArtPath = ""
    Me.Center()
    ApplyButton.Enabled = False
    Me.ShowDialog()
    
End

Public Sub _new()
    
    $handlerCoverArt = New NagatoTagEditHandlerCoverArt(IconSelectButton, AlbumArtPictureBox) As "Asakura"
    
End

Public Sub CancelButton_Click()

    Me.Close()

End

Public Sub ApplyButton_Click()
    
    NagatoQueue.EditTagsByTagIndexes([$index], getNewTag())
    If $coverArtPath Then NagatoQueue.ChangeCoverArtByIndexes([$index], $coverArtPath)
    
    Me.Close()
    
End

Public Sub TextBox_Change()

    ApplyButton.Enabled = True

End

' Public Sub AlbumArtPictureBox_MouseDown()
' 
'     ' HaruhiAlbumArtSelect.Show()
'     ' $observer = New Observer(HaruhiAlbumArtSelect) As "Asakura"
' 
' End

Public Sub Asakura_Selected()
    
    ApplyButton.Enabled = True
    
End

' Public Sub Asakura_Select(argFullPath As String)
'     
'     $coverArtPath = argFullPath
'     AlbumArtPictureBox.Picture = MikuruCroppedImage(argFullPath, AlbumArtPictureBox.H)
'     ApplyButton.Enabled = True
'     
' Catch
'     Return
'     
' End

' Public Sub IconSelectButton_Click()
' 
'     AlbumArtPictureBox_MouseDown()
' 
' End
