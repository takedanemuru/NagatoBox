' Gambas class file

Inherits NagatoDB

Public _$uniqueName As String = "Media"

Private $tableLibrary As NagatoTableLibrary

Public Sub EnsureLibrary(argPath As String) ' MUST be fullpath.
    
    $tableLibrary.EnsureLibrary(argPath)
    
End

Public Sub FetchDuration(argPath As String, argDuration As Float) 
    
    If Me.HasLibrary(argPath) Then $tableLibrary.FetchDuration(argPath, argDuration)
    
End

Public Sub AddTagsByNagatoTags(argPath As String, argNagatoTags As NagatoId3TagInfo)
    
    $tableLibrary.AddTagsByNagatoTags(argPath, argNagatoTags)
    
End

Public Function HasLibrary(argPath As String) As Boolean
    
    Return (Me._$connection.Find(Me.Table.Library, "path = &1", argPath).Count > 0)
    
End

Public Function GetMusicResultByPath(argPath As String) As Result
    
    Me.EnsureLibrary(argPath)
    
    Return Me._$connection.Find(Me.Table.Library, "path = &1", argPath)
    
End

Public Function GetAllResult() As Result
    
    Return Me._$connection.Find(Me.Table.Library)
    
End

Public Sub Search(argColumn As Integer, argQuery As String) As Result
    
    Dim yukiColumn As String = Choose(argColumn + 1, "title", "artist", "album") 
    Dim yukiQuery As String = Quote$(Subst$("%&1%", argQuery))
    Dim yukiExecBase As String = "SELECT * FROM library WHERE &1 LIKE &2"
    Dim yukiExec As String = Subst$(yukiExecBase, yukiColumn, yukiQuery)
    
    Return Me._$connection.Exec(yukiExec)
    
End

Public Sub _new()
    
    Me._SetConnection()
    
    $tableLibrary = New NagatoTableLibrary(Me._$connection)
    
End
