' Gambas class file

Create Static

Private $player As New NagatoPlayer As "TFEI"
Private $musicList As NagatoMusicList

Private $handlerPlayer As NagatoQueueHandlerPlayer
Private $handlerList As NagatoQueueHandlerList
Private $handlerProperties As NagatoQueueHandlerProperty

Public Sub _call(argSignal As Integer, argValues As Variant[])
    
    Select Case argSignal
        Case MikuruSignal.QueueHeader To MikuruSignal.QueueHeader + 999
            $handlerPlayer(argSignal, argValues)
        Case MikuruSignal.ListHeader To MikuruSignal.ListHeader + 999
            $handlerList(argSignal, argValues)
    End Select

End

Public Function GetProperty(argProperty As Integer) As Variant
    
    Return $handlerProperties.GetProperty(argProperty)
    
End

Public Sub ChangeCoverArtByIndexes(argIndexes As Integer[], argCoverArtPath As String)
    
    Dim yukiIndex As Integer
    
    For Each yukiIndex In argIndexes
        MikuruEyeD3.SetPicture($musicList[yukiIndex].Path, argCoverArtPath)
    Next
    
    If Not argIndexes.Exist($musicList.GetProerty(MikuruProperty.CurrentIndex)) Then Return
    $handlerProperties.Reload()
    Raise Broadcast(MikuruSignal.BroadcastStateChanged, Null)
    
End

Public Sub Activate(Optional argPaths As String[] = [""])
    
    $musicList = New NagatoMusicList(argPaths) As "TFEI"
    $handlerList = New NagatoQueueHandlerList($player, $musicList) As "TFEI"
    $handlerPlayer = New NagatoQueueHandlerPlayer($player, $musicList) As "TFEI"
    $handlerProperties = New NagatoQueueHandlerProperty($player, $musicList) As "TFEI"
    
End

Public Sub _get(argIndex As Integer) As NagatoMusicElement
    
    Return $musicList[argIndex]
    
End

Public Sub TFEI_Signal(argSignal As Integer, argValues As Variant[])
    
    Select Case argSignal
        Case MikuruSignal.BroadcastIndexMoved
            $handlerProperties.Reload()
        Case MikuruSignal.BroadcastQueueChanged
            If Not argValues Then $handlerProperties.Reload()
            $handlerList.SaveCurrentQueue()
    End Select
    
    NagatoBroadcast(argSignal, argValues)
    
End
