' Gambas class file

Property Read Rate As Float
Property Read Text As String

Private $player As MediaPlayer
Private $durationFetcher As New NagatoDurationFetcher

Event FetchDuration(argDuration As Float)

Private Function getDuration(Optional argRate As Float = 0) As String
    
    Return MikuruFloatToTime($player.Duration * argRate)
    
End

Public Function GetTextByRate(argRate As Float) As String ' argRate MUST be between 0 to 1

    Return Subst$("&1 / &2", getDuration(Min(argRate, 1)), getDuration(1))

Catch
    Return ""

End

Public Sub SetByRate(argRate As Float) 
    
    If argRate > 1 Then argRate = 1
    
    $player.Position = $player.Duration * argRate
    
End

Public Sub _new(argPlayer As MediaPlayer)
    
    $player = argPlayer
    
End

Private Function Rate_Read() As Float

    If $durationFetcher($player.Duration) Then Raise FetchDuration($player.Duration)

    Return ($player.Position / $player.Duration)

Catch
    Return 0
    
End

Private Function Text_Read() As String

    Dim yukiPosition As String = MikuruFloatToTime($player.Position)
    Dim yukiDuration As String = MikuruFloatToTime($player.Duration)

    If yukiDuration = 0 Then Return ""
    
    Return Subst$("&1 / &2", yukiPosition, yukiDuration)

End
