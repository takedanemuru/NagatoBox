' Gambas class file

Inherits NagatoPlayerAssistant

Property Read Rate As Float
Property Read Text As String

Private $durationFetcher As New NagatoDurationFetcher

Event FetchDuration(argDuration As Float)

Private Function getDuration(Optional argRate As Float = 0) As String
    
    Return MikuruFloatToTime(Me._$player.Duration * argRate)
    
End

Public Function GetTextByRate(argRate As Float) As String ' argRate MUST be between 0 to 1

    Return Subst$("&1 / &2", getDuration(Min(argRate, 1)), getDuration(1))

Catch
    Return ""

End

Public Sub SetByRate(argRate As Float) 
    
    If argRate > 1 Then argRate = 1
    
    Me._$player.Position = Me._$player.Duration * argRate
    
End

Public Sub _new(argPlayer As MediaPlayer)
    
    Me._$player = argPlayer
    
End

Private Function Rate_Read() As Float

    If $durationFetcher(Me._$player.Duration) Then Raise FetchDuration(Me._$player.Duration)

    Return (Me._$player.Position / Me._$player.Duration)

Catch
    Return 0
    
End

Private Function Text_Read() As String

    If Me._$player.Duration = 0 Then Return ""
    
    Return Me.GetTextByRate(Me._$player.Position / Me._$player.Duration)

End
