' Gambas class file

Property Current As Integer

Private $current As Integer 
Private $max As Integer
Private $randomOrder As New NagatoRandomizedOrder

Event Moved

Private Function checkCount(argCount As Integer) As Boolean
    
    If argCount = 0 Then 
        Return False
    Else
        If $max <> (argCount - 1) Then $randomOrder.Refresh(argCount - 1)
        $max = argCount - 1
        Return True
    End If
    
End

Private Sub normalNext()
    
    If $current = $max Then
        $current = 0
    Else
        Inc $current
    Endif
    
    Raise Moved
    
End

Private Sub shuffleNext()
    
    Dim yukiIndex As Integer
    
    Do
        yukiIndex = Rnd(0, $max + 1)
        If yukiIndex <> $current Then
            $current = yukiIndex
            Break
        End If
    Loop
    
    Raise Moved
    
End

Private Sub normalBack()
    
    If $current = 0 Then
        $current = $max
    Else
        Dec $current
    Endif
    
    Raise Moved
    
End

Public Sub Next(argCount As Integer)
    
    If Not checkCount(argCount) Then Return 
    
    If NagatoSettingsMusic.Shuffle Then
        shuffleNext()
    Else
        normalNext()
    End If
    
End

Public Sub Back(argCount As Integer)
    
    If Not checkCount(argCount) Then Return
    
    If NagatoSettingsMusic.Shuffle Then
        shuffleNext()
    Else 
        normalBack()
    End If
    
End

Private Function Current_Read() As Integer

    Return $current

End

Private Sub Current_Write(Value As Integer)

    $current = Value

End
