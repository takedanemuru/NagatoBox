' Gambas class file

Inherits NagatoWidget

Property Read IsVideoUrl As Boolean
Property Read Url As String

Private $webView As WebView

Public Sub _OnInitialize()
    
    $webView = New WebView(Me._$container) As "WebView"
    
    With $webView
        .Expand = True
        .Url = MikuruUrl.Startup
    End With
    
End

Public Sub _OnCall(argSignal As Integer, argValues As Variant[])
    
    Select Case argSignal
        Case MikuruSignal.UserRequestSetUrl
            $webView.Url = argValues[0]
    End Select
    
End

Public Sub WebView_Load()
    
    Dim yukiArgs As New Variant[]
    
    If Me.IsVideoUrl Then NagatoDBHistory.Push($webView.Url, $webView.Title)
    
    yukiArgs.Add(MikuruUrl.IsVideoUrl($webView.Url))
    yukiArgs.Add($webView.History.Index)
    yukiArgs.Add($webView.History.Count)
    
    Raise Signal(MikuruSignal.WebViewLoaded, yukiArgs)
    
End

Private Function IsVideoUrl_Read() As Boolean

    Return MikuruUrl.IsVideoUrl($webView.Url)

End

Private Function Url_Read() As String

    Return IIf(Me.IsVideoUrl, MikuruUrl.GetYoutubeUrl($webView.Url), $webView.Url)

End
