' Gambas class file

Inherits NagatoTableViewHandler

Property Read Path As String

Private $path As String = ""
Private $changesNotSaved As Boolean = False
Private $save As NagatoTableViewHandlerDataSave

Private Sub saveFileTo(argPath As String)
    
    $path = argPath
    $changesNotSaved = False
    $save.DataSaveTo(argPath)
    
End

Private Sub saveFile() As Boolean
    
    Dialog.Path = User.Home &/ "foobar.csv"
    Dialog.Title = ("Save File")
    If Dialog.SaveFile() Then Return False
    saveFileTo(Dialog.Path)
    Return True
    
End

Public Sub _OptionalOnInitialize()
    
    $save = New NagatoTableViewHandlerDataSave(Me._$tableView)
    
End

Public Sub New()
    
    $path = ""
    $changesNotSaved = False
    
End

Public Sub Open(argPath As String)
    
    $path = argPath
    $changesNotSaved = False
    
End

Public Sub IsClosable() As Boolean
    
    If Not $changesNotSaved Then Return True
    MikuruDialogPortalEnsureFileStatus()
    If MikuruDialogPortalEnsureFileStatus.Response = 1 Then Return False
    If MikuruDialogPortalEnsureFileStatus.Response = 3 Then Return True
    Return saveFile()
    
End

Public Sub Save()
    
    If $path Then saveFileTo($path)
    If Not $path Then saveFile()

End

Public Sub SaveAs() 
    
    saveFile()
    
End

Public Sub Changed()
    
    $changesNotSaved = True
    
End

Private Function Path_Read() As String

    Return $path

End
