' Gambas module file

Private Function getSartupUrl() As String
    
    Dim yukiUrl As String = ""
    Dim yukiArgs As String[]
    
    Args.Begin("Usage")
        yukiUrl = Args.Get("u", "url", "open specific url", "url to open")
    yukiArgs = Args.End()
    
    If yukiUrl = "" And If yukiArgs.Count > 0 Then yukiUrl = yukiArgs[0]
    If yukiUrl Begins "/" Then yukiUrl = "file://" & yukiUrl
    
    Return yukiUrl
    
End

Private Sub showMain()
    
    Dim yukiUrl As String = getSartupUrl()
    
    NagatoDBus.Register()
    HaruhiMain.Show()
    MikuruWebSettings.Initialize()
    If yukiUrl <> "" Then HaruhiMain.SetUrl(yukiUrl)
    Application.MainWindow = HaruhiMain
    
End

Private Sub tryOpen()
    
    If Object.IsValid(NagatoDBus.Proxy) Then 
        NagatoDBus.Proxy.Show()
    Else
        NagatoDBus.Unregister()
        showMain()
    End If
    
End

Public Sub Main()
    
    If NagatoDBus.IsUnique() Then
        showMain()
    Else If yukiUrl = "" Then
        tryOpen()
    Else
        NagatoDBus.Proxy.SetUrl(yukiUrl)
    End If
    
End
