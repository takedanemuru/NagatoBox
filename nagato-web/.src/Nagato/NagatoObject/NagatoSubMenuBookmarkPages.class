' Gambas class file

Inherits NagatoObject

Private $categories As Collection
Private $rootMenu As Menu

Private Sub addItem(argResult As Result, argCategory As String)
    
    Dim yukiMenu As New Menu($categories[argCategory]) As "BookmarkItemMenu"
    Dim yukiTitle As String = argResult[NagatoDB.Column.UserDefinedPageName]
    
    With yukiMenu
        .Text = MikuruCollapsedText[yukiTitle, Int(Screen.W / 4)]
        .Tag = argResult[NagatoDB.Column.Url]
        If Not NagatoSettings.ShowFavicon Then Return
        .Picture = NagatoDBFavicon.Get(argResult[NagatoDB.Column.Url])
    End With
    
End

Private Sub addBookmarkItems(argCategory As String, Optional argStartPosition As Integer = 0)
    
    Dim yukiResult As Result = NagatoDBBookmark.GetBookmarkResultByCategoryName(argCategory)

    For Each yukiResult
        If yukiResult[NagatoDB.Column.UserDefinedPageName] = "" Then Continue
        addItem(yukiResult, argCategory)
    Next
    
End

Public Sub Refresh()
    
    Dim yukiCategory As String
    
    For Each yukiCategory In NagatoDBBookmark.CategoryNames
        If Not NagatoDBBookmark.HasBookmarkInCategory(yukiCategory) Then Continue
        addBookmarkItems(yukiCategory)
    Next
    
End

Public Sub _new(argRootMenu As Menu, argCategoryCollection As Collection)
    
    $rootMenu = argRootMenu
    $categories = argCategoryCollection
    
End

Public Sub BookmarkItemMenu_Click()
    
    Raise Signal(MikuruSignal.WebNew, [Last.Tag])
    
End
