' Gambas class file

Inherits NagatoObject

Private Function getDestinationPath(argDefault As String) As String
    
    Dialog.Title = "Select Directory"
    Dialog.Path = Desktop.GetDirectory(argDefault)
    
    If Not Dialog.SelectDirectory() Then Return Dialog.Path
    
Finally
    Return ""
    
End

Private Sub getDailyMotionFileName(argDirectory As String) As String
    
    Dim yukiTitle As String = Replace(HaruhiMain.Title, "/", "_")
    
    Return argDirectory &/ yukiTitle & ".mp4"
    
End

Public Sub DownloadAsMovie(argUrl As String)
    
    Dim yukiDirectory As String = getDestinationPath("VIDEOS")
    
    If yukiDirectory = "" Then Return
    
    If argUrl Begins "http://www.dailymotion.com/video" Then
        Exec ["youtube-dl", argUrl, "-o", getDailyMotionFileName(yukiDirectory)] For Read As "YouTubeDL"
    Else
        Exec ["youtube-dl", "-f", "webm", argUrl, "-o", yukiDirectory &/ "%(title)s.%(ext)s"] For Read As "YouTubeDL"
    End If
    
End

Public Sub DownloadAsMusic(argUrl As String)
    
    Dim yukiDirectory As String = getDestinationPath("MUSIC")
    
    If yukiDirectory = "" Then Return

    Exec ["youtube-dl", "-x", "--audio-format", "mp3", argUrl, "-o", yukiDirectory &/ "%(title)s.%(ext)s"] For Read As "YouTubeDL"
    
End

Public Sub YouTubeDL_Read()
    
    Dim yukiLine As String
    
    Read #Last, yukiLine, -256
    
    Raise Signal(MikuruSignal.PersonaSetText, [yukiLine])
    
End

Public Sub YouTubeDL_Kill()
    
    Exec ["notify-send", "-a", "nagato-web", "Download finished."]
    
End
