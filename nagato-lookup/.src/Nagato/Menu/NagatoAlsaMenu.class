' Gambas class file

Private $parentMenu As Menu
Private $alsa As New NagatoAlsaState
Private $channel As String
Private $volume As Integer
    
Private Function addIndicationMenu() As Boolean
    
    Dim yukiMenu As New Menu($parentMenu)
    
    If $alsa.Channel <> "" Then 
        yukiMenu.Picture = MikuruIcons.Get("speaker")
        yukiMenu.Text = Subst$("ALSA &1: &2%", $alsa.Channel, $alsa.Volume)
        Return True
    Else
        yukiMenu.Text = ("Couldn't find valid alsa volume channel.")
        Return False
    Endif
    
End

Private Sub addVolumeMenu()
    
    Dim yukiVolume As Integer
    
    For yukiVolume = 100 DownTo 10 Step 10
        Object.New("NagatoMenuItemAlsaVolume", [$parentMenu, [$alsa.Channel, yukiVolume, $alsa.Volume]])
    Next
    
End

Private Sub initializeMenu()
    
    If addIndicationMenu() Then
        Object.New("NagatoMenuItemDummy", [$parentMenu])
        addVolumeMenu()
        Object.New("NagatoMenuItemDummy", [$parentMenu])
        Object.New("NagatoMenuItemAlsaMute", [$parentMenu, [$alsa.Channel, 0]])
    Endif
    
End

Private Sub addParentMenu(argRootMenu As Menu)
    
    $parentMenu = New Menu(argRootMenu) As "ParentMenu"
    
    With $parentMenu
        .Picture = MikuruIcons.Get("speaker")
        .Text = ("Alsa volume")
    End With
    
End

Public Sub _new(argMenu As Menu)
    
    addParentMenu(argMenu)
    Object.New("NagatoMenuItemDummy", [$parentMenu])
    
End

Public Sub ParentMenu_Show()
    
    $parentMenu.Children.Clear()
    initializeMenu()
    
End
