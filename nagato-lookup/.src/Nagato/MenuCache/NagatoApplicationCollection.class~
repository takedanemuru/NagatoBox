' Gambas class file

Private $Applications As New Collection
' Private $allApllications As New Collection
' Private $nagatoSoftwareCompilationApplications As New Collection
' Private $settings As New Collection
' Private $graphics As New Collection
' Private $medias As New Collection
' Private $educations As New Collection
' Private $networks As New Collection
' Private $developments As New Collection
' Private $offices As New Collection
' Private $games As New Collection
' Private $utilities As New Collection
' Private $systems As New Collection
' Private $kde4 As New Collection

Private Sub setApplication(argCategoryKey As String, argDesktopFile As NagatoDesktopFile)
    
    Dim yukiCollection As Collection = $Applications[argCategoryKey]
    
    Try yukiCollection.Add(argDesktopFile, argDesktopFile.Path)
    
End

Private Sub addDesktopFiles(argPath As String)
    
    Dim yukiDesktopFile As New NagatoDesktopFile(argPath)
    
    With yukiDesktopFile
        If .Path = "" Then Return
        $Applications["All"].Add(yukiDesktopFile, .Path)
        If Not .ShowIn Then Return
        ' If .HasCategory("Nagato") Then $nagatoSoftwareCompilationApplications.Add(yukiDesktopFile, .Path)
        ' If .HasCategory("Settings") Then $settings.Add(yukiDesktopFile, .Path)
        ' If .HasCategory("Graphics") Then $graphics.Add(yukiDesktopFile, .Path)
        ' If .IsMediaApplication Then $medias.Add(yukiDesktopFile, .Path)
        ' If .HasCategory("Education") Then $educations.Add(yukiDesktopFile, .Path)
        ' If .HasCategory("Development") Then $developments.Add(yukiDesktopFile, .Path)
        ' If .HasCategory("Network") Or If .HasCategory("Internet") Then $networks.Add(yukiDesktopFile, .Path)
        ' If .HasCategory("Office") Then $offices.Add(yukiDesktopFile, .Path)
        ' If .HasCategory("Game") Then $games.Add(yukiDesktopFile, .Path)
        ' If .HasCategory("Utility") Then $utilities.Add(yukiDesktopFile, .Path)
        ' If .HasCategory("System") Then $systems.Add(yukiDesktopFile, .Path)
        If .HasCategory("Nagato") Then setApplication("Nagato", yukiDesktopFile)
        If .HasCategory("Settings") Then setApplication("Settings", yukiDesktopFile)
        If .HasCategory("Graphics") Then setApplication("Graphics", yukiDesktopFile)
        If .IsMediaApplication Then setApplication("Medias", yukiDesktopFile)
        If .HasCategory("Education") Then setApplication("Educations", yukiDesktopFile)
        If .HasCategory("Development") Then setApplication("Developments", yukiDesktopFile)
        If .HasCategory("Network") Or If .HasCategory("Internet") Then setApplication("Networks", yukiDesktopFile)
        If .HasCategory("Office") Then setApplication("Offices", yukiDesktopFile)
        If .HasCategory("Game") Then setApplication("Games", yukiDesktopFile)
        If .HasCategory("Utility") Then setApplication("Utilities", yukiDesktopFile)
        If .HasCategory("System") Then setApplication("Systems", yukiDesktopFile)
    End With
    
End

Private Sub removeDesktopFiles(argPath As String)
    
    Dim yukiCollection As Collection
    
    For Each yukiCollection In $Applications
        Try yukiCollection.Remove(argPath)
    Next
    
End

Private Sub addKde4DesktopFiles(argPath As String)
    
    Dim yukiDesktopFile As New NagatoDesktopFile(argPath)
    
    Try $Applications["Kde4"].Add(yukiDesktopFile, yukiDesktopFile.Path)

End

Private Sub addApplications(argDirectory As String, Optional argKDE As Boolean = False)
    
    Dim yukiPath As String
    
    For Each yukiPath In Dir(argDirectory).Sort()
        If File.Ext(argDirectory &/ yukiPath) = "desktop" Then
            addDesktopFiles(argDirectory &/ yukiPath)
            If argKDE Then addKde4DesktopFiles(argDirectory &/ yukiPath)
        Endif
    Next
    
End

Public Sub initializeCollection()
    
    Dim yukiCategory As String
    Dim yukiCollection As Collection
    
    For Each yukiCategory In MikuruApplicationCategories.All
        yukiCollection = New Collection
        $Applications.Add(yukiCollection, yukiCategory)
    Next
    
    ' With $Applications 
    '     .Add($allApllications, "All")
    '     .Add($nagatoSoftwareCompilationApplications, "Nagato")
    '     .Add($settings, "Settings")
    '     .Add($graphics, "Graphics")
    '     .Add($medias, "Medias")
    '     .Add($educations, "Educations")
    '     .Add($networks, "Networks")
    '     .Add($developments, "Developments")
    '     .Add($offices, "Offices")
    '     .Add($games, "Games")
    '     .Add($utilities, "Utilities")
    '     .Add($systems, "Systems")
    '     .Add($kde4, "Kde4")
    ' End With
    
End

Public Sub Delete(argPath As String)
    
    removeDesktopFiles(argPath)
    
End

Public Sub Modefy(argPath As String)
    
    removeDesktopFiles(argPath)
    addDesktopFiles(argPath)
    
End

Public Function GetApplications(argCategory As String) As Collection
    
    Return $Applications[argCategory]
    
End

Public Sub _new()
    
    initializeCollection()
    addApplications(MikuruApplicationDirectory.Global)
    addApplications(MikuruApplicationDirectory.KDE4, True)
    addApplications(MikuruApplicationDirectory.Local)

End
