' Gambas class file

Inherits NagatoObject

Private $processId As Integer = 0

Private Sub executeCommand(argCommand As String[])
    
    Dim yukiProcess As Process
    
    Me.Stop()
    
    yukiProcess = Exec argCommand For Read As "MPV"
    $processId = yukiProcess.Id
    
    Raise Signal(MikuruSignal.MpvStarted, Null)

End

Public Sub Play(argUrl As String)
    
    executeCommand(["mpv", argUrl])
    
End

Public Sub PlayNoVideo(argUrl As String)
    
    executeCommand(["mpv", "--no-video", argUrl])
    
End

Public Sub Stop()
    
    If $processId <> 0 Then Exec ["kill", $processId] Wait
    
    $processId = 0
    
End

Public Sub MPV_Read()
    
    Dim yukiLine As String
    
    Read #Last, yukiLine, -256
    
    Raise Signal(MikuruSignal.MpvPlaying, [yukiLine])
    
End

Public Sub MPV_Kill()
    
    Raise Signal(MikuruSignal.MpvKilled, Null)
    
End
