' Gambas class file

Private $queryType As Integer = 0
Private $gridViewHandler As NagatoGridViewHandler

Private Function getResult(argQueryWord As String) As Result
    
    Select Case $queryType
        Case NagatoQuerySelector.TypeJapanese
            Return NagatoDBGeneralDict.Get(Subst$("%&1%", argQueryWord))
        Case NagatoQuerySelector.TypePronunciation
            Return NagatoDBGeneralDict.GetWithPronunciation(Subst$("%&1%", argQueryWord))
        Case NagatoQuerySelector.TypeEnglish
            Return NagatoDBGeneralDict.GetWithEnglish(Subst$("%&1%", argQueryWord))
    End Select
    
End

Private Function searh(argQueryWord As String) As String
    
    Dim yukiResult As Result = getResult(argQueryWord)
    
    $gridViewHandler.Clear()
    
    If yukiResult.Count = 0 Then Message.Info(("YUKI.N > Query not found."), ("OK"))
    
    Debug yukiResult.Count
    
    For Each yukiResult
        With NagatoDBGeneralDict
            $gridViewHandler.SetData(yukiResult[.ColumnJapanese], yukiResult[.ColumnPronunciation], yukiResult[.ColumnEnglish])
        End With
    Next
    
End

Public Sub _new()

    Dim yukiWidget As Object
    
    yukiWidget = New NagatoQuerySelector(MenuPanel) As "TFEI"
    yukiWidget = New NagatoPanelSpacer(MenuPanel)
    yukiWidget = New NagatoSearchBox(MenuPanel) As "TFEI"
    yukiWidget = New NagatoStarButton(MenuPanel) As "TFEI"
    
    $gridViewHandler = New NagatoGridViewHandler(Me)

End

Public Sub Form_Open()

    Me.Center()
    Application.MainWindow = Me

End

Public Sub TFEI_Signal(argEvent As Integer, argArgs As Variant[])
    
    Select Case argEvent
        Case MikuruSignal.Query 
            searh(argArgs[0])
        Case MikuruSignal.QueryTypeChanged
            Debug argArgs[0]
            $queryType = argArgs[0]
        Case MikuruSignal.ApplicationAbout
            HaruhiAbout.ShowDialog()
        Case MikuruSignal.ApplicationQuit
            Me.Close()
    End Select
    
End
