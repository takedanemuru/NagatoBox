' Gambas module file

Property Read HomePath As String
Property RelativePath As String

Private Const MacroHome As String = "NAGATO_MACRO_HOME"
Private Const MacroRelativePath As String = "NAGATO_MACRO_DIR"
Private Const MacroImageLink As String = "![NAGATO_MACRO_IMAGE](./"
Private Const MacroJekyllNow As String = "![_config.yml]({{ site.baseurl }}"

Private $relativePath As String

Public Function Set(argSourceText As String) As String
    
    Dim yukiText As String = argSourceText
    
    yukiText = Replace$(yukiText, MacroRelativePath, Me.RelativePath)
    yukiText = Replace$(yukiText, MacroHome, Me.HomePath)
    yukiText = Replace$(yukiText, MacroImageLink, Subst$("![img](&1/", Me.RelativePath))
    yukiText = Replace$(yukiText, MacroJekyllNow, Subst$("![img](&1/", File.Dir(Me.RelativePath)))
    
    Debug Me.HomePath
    Debug Me.RelativePath
    
    Return yukiText
    
End

Public Function ConvertToRelative(argSourceText As String) As String
    
    Dim yukiText As String = argSourceText
    
    yukiText = Replace$(yukiText, MacroRelativePath, File.Dir($relativePath))
    yukiText = Replace$(yukiText, MacroHome, User.Home)
    yukiText = Replace$(yukiText, MacroImageLink, Subst$("![img](&1/", File.Dir($relativePath)))
    
    Return yukiText
    
End

Private Function HomePath_Read() As String

    Return Subst$("file://&1", User.Home)

End

Private Function RelativePath_Read() As String

    Return Subst$("file://&1", File.Dir($relativePath))

End

Private Sub RelativePath_Write(Value As String)

    $relativePath = Value

End
