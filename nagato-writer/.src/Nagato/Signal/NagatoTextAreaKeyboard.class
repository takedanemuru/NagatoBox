' Gambas class file

Inherits NagatoWidgetHandler

Private Sub keyEventWithControl()
    
    If Key.Shift And If Key.Code = Key["s"] Then Raise Signal(MikuruSignal.FileSaveAs, Null)
    If Key.Code = Key["s"] Then Raise Signal(MikuruSignal.FileSave, Null) 
    If Key.Code = Key["p"] Then Raise Signal(MikuruSignal.ViewPreview, Null)
    If Key.Code = Key["r"] Or If Key.Code = Key["f"] Then HaruhiReplacement.Show() 
    
End

Private Sub replaceTab()
    
     Stop Event
     Me._$widget.Insert(Space$(NagatoSettingsView.TabSize))
    
End

Private Sub replaceBackspace()
    
    Dim yukiPosition As Integer = (Me._$widget.Pos - NagatoSettingsView.TabSize + 1)
    
    If String.Mid(Me._$widget.Text, yukiPosition, NagatoSettingsView.TabSize) = Space$(NagatoSettingsView.TabSize) Then
        Stop Event
        Me._$widget.Select(yukiPosition - 1, NagatoSettingsView.TabSize)
        Me._$widget.Selection.Text = ""
    End If
    
Catch
    Return
    
End

Public Sub CheckCursorPosition()
    
    Me.Asakura_Cursor()
    
End

Public Sub Asakura_KeyPress()

    If Key.Control Then keyEventWithControl()
    If Key.Code = Key.Tab And If NagatoSettingsView.TabSize <> 0 Then replaceTab()
    If Key.Code = Key.BackSpace And If NagatoSettingsView.TabSize <> 0 Then replaceBackspace()

End

Public Sub Asakura_Cursor()
    
    If Me._$widget.Line + 5 > Split(Me._$widget.Text, "\n").Count Then
        Raise Signal(MikuruSignal.ViewMoveToBottom, Null)
    Else
        Raise Signal(MikuruSignal.ViewMoveCursor, [Me._$widget.Line])
    Endif
    
End

Public Sub Asakura_Change()
    
    If NagatoSettings.LivePreview Then Raise Signal(MikuruSignal.ViewPreview, Null)
    
End
