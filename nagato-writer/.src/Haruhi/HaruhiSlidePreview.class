' Gambas class file

Private $htmlPath As String

Private Sub resetHtmlPath()
    
    If Exist($htmlPath) Then Kill $htmlPath
    $htmlPath = Temp$() & ".html" 
    
End

Private Function getCommand() As String[]
    
    Dim yukiEngine As String = NagatoValueListSliderEngine.Values[NagatoSettingsSlide.Engine]
    Dim yukiCommand As String[] = ["pandoc", "--to", yukiEngine]
    
    With yukiCommand
        .Insert(["-s", "-i", MikuruHtmlConverter.WorkingFileAbsolute])
        .Insert([Subst$("--include-after-body=&1", NagatoValueListCssSlide.Current)])
        .Insert(["--parse-raw"])
        .Insert(["-o", $htmlPath])
        .Insert(["--slide-level", NagatoSettingsSlide.SectionLevel])
    End With

    Return yukiCommand    
    
End

Public Sub Set()
    
    resetHtmlPath()
    Exec getCommand() Wait
    
    WebSettings[WebSettings.JavascriptEnabled] = True
    SlideWebView.Url = "file://" & Url$($htmlPath)
    
    If Not NagatoSettingsSlide.DoNotShowEscape Then HaruhiDialogStartSlide.ShowDialog()
    
End

Public Sub SlideWebView_KeyPress()

    If Key.Code = Key.Esc Then Me.Close()
    If Key.Code = Key["?"] Then HaruhiDialogStartSlide.ShowDialog()

End
