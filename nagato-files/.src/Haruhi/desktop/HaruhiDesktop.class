' Gambas class file

Private Const Margin As Integer = 2

Private $desktop As NagatoDesktop
Private $panel As NagatoDesktopPanel
Private $timer As New Timer As "DesktopTimer"

Event Timer

Private Sub initializeForm()
    
    With Me
        .X = 0
        .Y = 0
        .W = Screen.W
        .H = Screen.H
    End With
    
End

Public Sub RealodDesktopWallpaper()
    
    $desktop.ReloadDesktopWallpaper()
    
End

Public Sub Form_Open()

    Application.MainWindow = Me
    initializeForm()
    
    If MikuruX11.SetAsRoot(Me.Id) Then 
        NagatoDBus.Register()
        $desktop = New NagatoDesktop(Me)
        $panel = New NagatoDesktopPanel(Me)
        MikuruX11.ReservePanelHeightOnScreen(Me.Id)
        $timer.Enabled = True
        HaruhiPersona.SetText(Subst$(("YUKI.N > Welcome back, &1"), System.User.Name))
    Else
        Message.Error("YUKI.N > Fail to activate nagato-desktop", ("OK"))
        Me.Close()
    End If

End

Public Sub Form_Close()
    
    $timer.Enabled = False
    NagatoDBus.Unregister()
    
End

Public Sub DesktopTimer_Timer()
    
    Raise Timer
    
End
