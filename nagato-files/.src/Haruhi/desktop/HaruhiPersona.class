' Gambas class file

Private $persona As NagatoPersona
Private $notifyQueue As NagatoNotifyQueue
Private $observer As Observer

Public Sub _new()
    
    $persona = New NagatoPersona(Me)
    $notifyQueue = New NagatoNotifyQueue
    $observer = New Observer(HaruhiBalloon) As "Asakura"
    
End

Public Sub Fortune()
    
    $notifyQueue.EnqueueMessage(NagatoNotifyQueue.PriorityNone, [MikuruFortune.Get()])
    
End

Public Sub Notify(argApp As String, argSummary As String, argBody As String, argUrgency As Integer)
    
    Dim yukiMessage As String[] = [argSummary, argBody]
    Dim yukiAppName As String = Subst$(("YUKI.N > <br>We got a message from &1."), argApp)
    
    If argApp Then yukiMessage.Add(yukiAppName, 0)
    
    $notifyQueue.EnqueueMessage(argUrgency, yukiMessage)

End

Public Sub SetText(argText As String)
    
    $notifyQueue.EnqueueMessage(NagatoNotifyQueue.PriorityNone, [argText])
    
End

Public Sub Welcome()
    
    Dim yukiMessage As String = Subst$(("YUKI.N > Welcome back, &1"), System.User.Name)
    
    $notifyQueue.EnqueueMessage(NagatoNotifyQueue.PriorityHello, [yukiMessage])

End

Public Sub Form_Open()
    
    $persona.Activate()
    
    Me.X = 50
    
End

Public Sub Form_Close()
    
    HaruhiBalloon.Close()
    
End

Public Sub Form_DblClick()
    
    Me.Close()
    
End

Public Sub Asakura_Close()
    
    $notifyQueue.CancelMessage()
    
End
