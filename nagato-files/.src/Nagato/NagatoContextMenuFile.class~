' Gambas class file

Inherits NagatoContextMenu

Private Sub addUnarchiveMenu()
    
    Dim yukiMenu As NagatoMenuItemUnarchive
    
    yukiMenu = New NagatoMenuItemUnarchive(Me._$rootMenu, Last.Key)
    
End

Private Sub addExecuteMenu()
    
    Dim yukiMenu As NagatoMenuItemExecute
    
    yukiMenu = New NagatoMenuItemExecute(Me._$rootMenu, Last.Key)
    
End

Private Sub addOpenWithDefaultMenu(argDesktopFile As DesktopFile)
    
    Dim yukiMenu As New Menu(Me._$rootMenu) As "OpenFileMenu"
    
    With yukiMenu
        .Text = Subst$(("Open with &1"), argDesktopFile.Name)
        .Picture = MikuruIcon.GetDesktopEntryIcon(argDesktopFile.Path)
        .Tag = NagatoMenuPipe.FileOpen
    End With
    
End

Private Sub addDefault()
   
   Dim yukiDefaultApplication As New NagatoDefaultApplication(Me._$path)
   
   If yukiDefaultApplication.NotFound Then Return
   
   addOpenWithDefaultMenu(yukiDefaultApplication.DesktopFile)
    
End

Private Sub addFileOpenMenu()
    
    If MikuruMimeType.IsArchiveFile(Me._$path) Then
        addUnarchiveMenu()
    Else If DesktopMime.FromFile(Me._$path).Type = "application/x-desktop" Then
        addExecuteMenu()
    Else
        addDefault()
    Endif
    
End

Private Sub addFileOpenWithMenu()
    
    Dim yukiMenu As New Menu(Me._$rootMenu)
    Dim yukiSelectApplicationMenu As NagatoSelectApplicationMenu
    
    With yukiMenu
        .Text = ("Open with ...")
    End With
    
    yukiOpenWithMenu = New NagatoOpenWithApplicationMenu(yukiMenu, Me._$path)
    
End

' Private Sub addCreateMenu()
'     
'     Dim yukiMenu As New Menu(Me._$rootMenu)
'     Dim yukiSubMenu As NagatoCreateMenu
'     
'     With yukiMenu
'         .Text = ("Create")
'     End With
'     
'     yukiSubMenu = New NagatoCreateMenu(yukiMenu) As "Menu"
'     
' End

Public Sub _AddChildMenus()
    
    With NagatoMenuPipe
        addFileOpenMenu()
            Me._AddContextMenu("", 0) ' As Spacer
        addFileOpenWithMenu()
        ' addCreateMenu()
        Me._AddContextMenu(("Copy file path"), .PathCopyToClipboard, MikuruIcon.Get("clipboard"))
            Me._AddContextMenu("", 0) ' As Spacer
        Me._AddContextMenu(("Rename"), .FileRename)
        Me._AddContextMenu(("Delete"), .FileDelete, MikuruIcon.Get("bin"))
        Me._AddContextMenu(("Tagging"), .TagAdd, MikuruIcon.Get("tag"))
        Me._AddContextMenu(("Remove Tag"), .TagRemove, MikuruIcon.Get("tag"))
    End With
    
End

Public Sub OpenFileMenu_Click()
    
    Raise MenuEventWithArg(NagatoMenuPipe.FileOpen, Me._$path)
    
End
