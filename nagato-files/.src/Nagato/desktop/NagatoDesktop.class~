' Gambas class file

Public Const SpecialKeyClock As String = "DesktopClock"
Public Const SpecialKeyTrashBin As String = "DesktopTrashBin"

Private $iconView As IconView
Private $observer As NagatoDesktopObserverHandler
Private $wallpaper As NagatoDesktopWallpaperHandler
Private $icons As NagatoDesktopIconsHandler
Private $mouse As NagatoDesktopMouseHandler

Private Sub initializeIconView(argContainer As Container)
    
    $iconView = New IconView(argContainer) As "DesktopIconView"
    
    With $iconView
        .Expand = True
        .Orientation = Arrange.Horizontal
        .Border = False
        .Mode = Select.Single
    End With
    
End

Public Sub _new(argContainer As Container)
    
    initializeIconView(argContainer)
    
    $wallpaper = New NagatoDesktopWallpaperHandler($iconView)
    $icons = New NagatoDesktopIconsHandler($iconView)
    $mouse = New NagatoDesktopMouseHandler($iconView) As "Handler"
    $observer = New NagatoDesktopObserverHandler($iconView) As "Handler"

End

Public Sub Handler_RequestRefresh()
    
    Debug "request"
    
    $icons.Refresh($mouse.SelectedPaths)
    
End

Public Sub Handler_Signal(argEvent As Integer, argValue As Variant)
    
    Debug argValue
    
    Select Case argEvent
        Case NagatoMenuPipe.ObserverDelete
            $mouse.Delete(Desktop.Path &/ argValue)
            $icons.Refresh($mouse.SelectedPaths)
        Case NagatoMenuPipe.ObserverModefy
            $mouse.ClearAll()
            $icons.Refresh($mouse.SelectedPaths)
    End Select
    
End
