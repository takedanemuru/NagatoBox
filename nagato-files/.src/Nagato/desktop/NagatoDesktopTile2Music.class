' Gambas class file

Inherits NagatoDesktopTile2

Private $proxy As NagatoDBusAccessNagatoPlayerX
Private $descriptionPainter As NagatoDescriptionPainterStandard

Private Sub getBaseImage() As Image
    
    Dim yukiBaseImage As Image
    
    If Exist($proxy.GetCoverArtPath()) Then
        yukiBaseImage = Image.Load($proxy.GetCoverArtPath())
        yukiBaseImage = yukiBaseImage.Stretch(MikuruUxTile.TileSize, MikuruUxTile.TileSize)
    Else
        yukiBaseImage = New Image(MikuruUxTile.TileSize, MikuruUxTile.TileSize, Color.Red)
    Endif
    
    Return yukiBaseImage
    
End

Private Sub paintProgress()
    
    Paint.Brush = Paint.Color(Color.Orange)
        Paint.Rectangle(0, MikuruUxTile.TileSize - 2, MikuruUxTile.TileSize * $proxy.GetRate(), 2)
    Paint.Fill()
    
End

Private Sub getThumbnail() As Image
    
    Dim yukiBaseImage As Image = getBaseImage()
    
    Paint.Begin(yukiBaseImage)
        NagatoLabelPainterFacade.Paint(MikuruTileMode.SpecialPlayerX, "")
        $descriptionPainter.Paint($proxy.GetTextTile())
        paintProgress()
    Paint.End()
    
    Return yukiBaseImage
    
End

Private Sub getThumbnailNotActivated() As Image
    
    Dim yukiBaseImage As New Image(128, 128, Color.Red + Color.Transparent * 128)
    
    Return yukiBaseImage
    
End

Public Function getLabelText() As String
    
   Return ""
    
End

Private Sub paintLabel()
    
    
    
End

Public Function getIcon() As Picture
    
    
    
End

Public Sub _OnReload()
    
    Try Me._$iconView.Remove(NagatoDesktopSpecialKey.Music)
    
    Me._$iconView.Add(NagatoDesktopSpecialKey.Music, "", getBaseImage().Picture)
    
End

Public Sub _OnTimer() ' override
    
    If Not DBus.Session.Applications.Exist("org.gambas.nagato-player-x") Then
        Me._$iconView[NagatoDesktopSpecialKey.Music].Picture = getThumbnailNotActivated().Picture
    Else 
        Me._$iconView[NagatoDesktopSpecialKey.Music].Picture = getThumbnail().Picture
    End If
    
End

Public Sub _OptionalOnInitialize()
    
    $descriptionPainter = New NagatoDescriptionPainterStandard(Color.Gray + Color.Transparent * 64)
    $proxy = New NagatoDBusAccessNagatoPlayerX
    
End
