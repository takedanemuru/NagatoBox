' Gambas class file

Inherits NagatoDesktopTile2

Private Const FontSize As Integer = 10
Private $trashObserver As NagatoDesktopTrashObserver

Private Sub paintLabel()
    
    Dim yukiHeight As Integer = Application.Font.RichTextHeight($trashObserver.Text, NagatoSettingsTile.Size - 16)
    
    With NagatoSettingsTile
        Paint.DrawRichText($trashObserver.Text, 0, .Size - yukiHeight - 16, .Size, yukiHeight + 16, Align.Center)
    End With
    
End

Public Function getIcon() As Picture
    
    Dim yukiImage As Image = MikuruTileBaseImage[Color.DarkGreen, 128]
    
    Paint.Begin(yukiImage)
        Paint.Brush = Paint.Color(Color.White)
        Paint.Font.Size = FontSize
        Paint.Font.Bold = True
        Paint.DrawPicture(Stock["64/trash"], 32, 8)
        paintLabel()
        Paint.Fill()
    Paint.End()
    
    Return yukiImage.Picture
    
End

Private Sub refreshIcon()
    
    Try Me._$iconView.Remove(NagatoDesktopSpecialKey.TrashBin)
    If Not NagatoSettingsDesktopTile.ShowTrashBin Then Return
    Me._$iconView.Add(NagatoDesktopSpecialKey.TrashBin, "", getIcon())
    
End

Public Sub _OnReload()
    
    refreshIcon()
    
End

Public Sub _OptionalOnInitialize()
    
    $trashObserver = New NagatoDesktopTrashObserver As "TrashObserver"
    
End

Public Sub _OnTimer() ' override
    
    'ignore
    
End

Public Sub TrashObserver_Changed()
    
    refreshIcon()
    
End
