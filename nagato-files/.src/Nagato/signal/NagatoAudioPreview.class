' Gambas class file

Inherits NagatoSignalWidget

Private $player As MediaPlayer 
Private $path As String
Private $timer As New Timer As "Timer"
Private $widgets As NagatoAudioPreviewWidgets

Public Sub Set(argPath As String)
    
    $timer.Enabled = False
    Try $player.Stop()

    If DesktopMime.FromFile(argPath).Type Begins "audio" Then
        $path = argPath
        $widgets.NewPath(True)
    Else
        $widgets.NewPath(False)
    Endif
        
End

Public Sub _InitializeWidgets()
    
    $player = New MediaPlayer As "MediaPreview"
    $widgets = New NagatoAudioPreviewWidgets(Me._$container) As "Widgets"
    
End

Public Sub Widgets_Toggle()
    
    If $player.State <> Media.Playing Then
        If $player.URL <> Media.URL($path) Then $player.URL = Media.URL($path)
        Try $player.Play()
        $timer.Enabled = True
        $widgets.SetButtonPause()
    Else
        $player.URL = Media.URL($path)
        Try $player.Pause()
        $timer.Enabled = False
        $widgets.SetButtonPause()
    End If
    
End

Public Sub Timer_Timer()
    
    Dim yukiRate As Float = $player.Position / $player.Duration
    
    $widgets.SetProgressBarValue(yukiRate)
    
Catch
    $widgets.SetProgressBarValue(0)
    
End
