' Gambas class file

Private Const ServiceName As String = "org.gambas.dataovermind.systemmonitor"
Private Const ObjectPath As String = "/org/dataovermind/systemmonitor"
Private Const InterfaceName As String = "org.gambas.dataovermind.systemmonitor.tfei"

Private $proxy As DBusProxy

Public Function GetText() As String
    
    Dim yukiFormat As String = ("  CPU: &1   Memory: &2   Swap: &3   Processes: &4")
    Dim yukiCpuUsage As String = Format$($proxy.CpuUsage, "##.00%")
    Dim yukiMemoryUsage As String = Format$($proxy.MemoryUsage, "##.00%")
    Dim yukiSwapUsage As String = Format$($proxy.SwapUsage, "##.00%")
    Dim yukiProcessCount As String = $proxy.ProcessCount
    
    Return Subst$(yukiFormat, yukiCpuUsage, yukiMemoryUsage, yukiSwapUsage, yukiProcessCount)
    
Catch
    Return ""
    
End

Public Sub Activate()
    
    If Not DBus.Session.Applications.Exist(ServiceName) Then Return
    
    $proxy = DBus[ServiceName][ObjectPath, InterfaceName]
    
End

Public Sub _new()
    
    Try Exec "dataovermind-systemmonitor"
    
End
