' Gambas class file

Property Read Activated As Boolean

Private Const ServiceName As String = "org.gambas.dataovermind.rssfeeder"
Private Const ObjectPath As String = "/org/dataovermind/rssfeeder"
Private Const InterfaceName As String = "org.gambas.dataovermind.rssfeeder.tfei"

Private $proxy As DBusProxy
Private $feedIndex As Integer = 0
Private $itemIndex As Integer = 0

Private Sub increaseFeedIndex()
    
    $itemIndex = 0
    
    Inc $feedIndex
    
    If $proxy.FeedCount = $feedIndex Then $feedIndex = 0
    
End

Public Sub Next()
    
    Inc $itemIndex
    
    If $proxy.GetFeedItemsCount($feedIndex) = $itemIndex Then increaseFeedIndex()
    
End

Public Function GetDescription() As String
    
    Dim yukiItem As String[] = $proxy.GetFeedItem($feedIndex, $itemIndex)
    
    Return yukiItem[0]
   
Catch
    Debug Error.Text
    Return "YUKI.N > Please wait ..."
    
End

Public Sub Activate()
    
    If Not DBus.Session.Applications.Exist(ServiceName) Then Shell "dataovermind-rssfeeder"
    If DBus.Session.Applications.Exist(ServiceName) Then 
        If Not Object.IsValid($proxy) Then $proxy = DBus[ServiceName][ObjectPath, InterfaceName]
    End If
    
End

Private Function Activated_Read() As Boolean

    If Not DBus.Session.Applications.Exist(ServiceName) Then Return False
    If Not Object.IsValid($proxy) Then Return False 

    Return True

End
