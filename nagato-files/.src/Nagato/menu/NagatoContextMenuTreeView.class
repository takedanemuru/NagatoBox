' Gambas class file

Inherits NagatoContextMenu

Public Enum ContextNone, ContextExecute, ContextRefresh

Private Sub addExecuteMenu()
    
    Dim yukiMenu As NagatoMenuItemExecute
    
    yukiMenu = New NagatoMenuItemExecute(Me._$rootMenu, Last.Key)
    
    Me._AddContextMenu("", Me.ContextNone)
    
End

Private Sub addOpenWithMenu()
    
    Dim yukiOpenWithMenu As NagatoOpenWithApplicationMenu
    
    yukiOpenWithMenu = New NagatoOpenWithApplicationMenu(Me._$rootMenu, Last.Key)
    
End

Private Sub addRenameMenu()
    
    Dim yukiMenu As New Menu(Me._$rootMenu) As "RenameMenu"
    
    With yukiMenu
        .Text = ("Rename")
    End With
    
End

Private Sub addDeleteMenu()
    
    Dim yukiMenu As New Menu(Me._$rootMenu) As "DeleteMenu"
    
    With yukiMenu
        .Text = ("Delete")
        .Picture = MikuruIcon("bin")
    End With
    
End

Private Function rename(argPath As String) As Boolean
    
    If IsDir(argPath) Then
        If HaruhiRename.SetPath(argPath) Then
            Return HaruhiRename.ShowDialog() = MikuruDialog.ResponseApply
        End If
    Else
        Return NagatoFilerDialogs.Rename(argPath)
    Endif
    
    Return False
    
End

Public Sub _AddChildMenus()
    
    If Not Exist(Last.Key) Then
        Me._AddContextMenu(("File or Directory is Missing"), Me.ContextRefresh, MikuruIcon.Get("button-rotate-cw"))
    Else
        If DesktopMime.FromFile(Last.Key).Type = "application/x-desktop" Then addExecuteMenu()
        If Not IsDir(Last.Key) Then addOpenWithMenu()
        If IsDir(Last.Key) Then Me._AddContextMenu(("Open New Tab"), 0)
        If Not NagatoXdg.IsUserDir(Last.Key) Then addRenameMenu()
        If Not NagatoXdg.IsUserDir(Last.Key) Then addDeleteMenu()
        Me._AddContextMenu(("Refresh"), Me.ContextRefresh, MikuruIcon.Get("button-rotate-cw"))
    End If
    
End

Public Sub RenameMenu_Click()
    
    If rename(Me._$path) Then Raise Signal(Me.ContextRefresh, [Me._$path])
    
End

Public Sub DeleteMenu_Click()
    
    NagatoTrash.Delete([Me._$path])
    
    Raise Signal(Me.ContextRefresh, [Me._$path])
    
End

Public Sub ContextMenu_Click()
    
    TFEI.AddNewDirectory(Me._$path)
    
End
