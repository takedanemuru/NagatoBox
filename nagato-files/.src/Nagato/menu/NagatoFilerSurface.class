' Gambas class file

Inherits NagatoObject

Property Read Selection As String[]

Private $iconView As NagatoFilerIconView
Private $userInput As NagatoFilerUserInput

Private Sub clearSelection()
    
    Dim yukiSelectedPaths As String[] = $userInput.Paths.Copy()
    
    $userInput.ClearWithoutLastSelected()
    $iconView.ClearSelection(yukiSelectedPaths)
    
End

Public Sub SetFocus(argPath As String)
    
    $iconView.SetFocus(argPath)
    
End

Public Sub Refresh(argDirectory As String)
    
    $userInput.ClearAll()
    $iconView.Refresh(argDirectory, $userInput.Selection, $userInput.LastSelected)
    
End

Public Sub RefreshWithSearchQuery(argPaths As String[])
    
    $iconView.RefreshWithSearchResult(argPaths, $userInput.Selection)
    
End

Public Sub Delete(argDirectory As String, argPath As String)
    
    If $iconView.Delete(argPath) Then $userInput.Remove(argPath)
    If MikuruDirectory.GetCountNonRecursive(argDirectory, NagatoSettings.ShowHidden) > 0 Then Return
    Me.Refresh(argDirectory)
    
End

Public Sub HasKey(argPath As String) As Boolean
    
    Return $iconView.Exist(argPath)
    
End

Public Sub SelectAll(argDirectory As String)
    
    NagatoSettings.MultipleSelection = True
    $userInput.SetPaths(MikuruDirectory.GetAll(argDirectory))
    $iconView.Refresh(argDirectory, $userInput.Selection, $userInput.LastSelected)
    
End

Public Sub InvertSelection(argDirectory As String)
    
    NagatoSettings.MultipleSelection = True
    $userInput.SetPaths(MikuruDirectory.GetInverted(argDirectory, $userInput.Selection))
    $iconView.Refresh(argDirectory, $userInput.Selection, $userInput.LastSelected)
    
End

Public Sub EnsureVisible()
    
    $iconView.Ensure($userInput.LastSelected)
    
End

Public Sub ShowLostDirectory()
    
    $iconView.ShowLostDirectory()
    
End

Public Sub MouseDown(argPath As String, argMouseLeft As Boolean)
    
    $userInput.Push(argPath, Mouse.Left)
    If Not NagatoSettings.MultipleSelection Then clearSelection()
    $iconView.ResetIcon(argPath, $userInput.Exist(argPath))
    TFEI.SetFileProperty($userInput.LastSelected)
    
End

Public Sub RefreshKeepQuery(argDirectory As String)
    
    $iconView.RefreshKeepQuery(argDirectory, $userInput.Selection, $userInput.LastSelected)
    
End

Public Sub _new(argContainer As Container)
    
    Dim yukiInitializer As New NagatoIconViewInitializer(argContainer)

    $userInput = New NagatoFilerUserInput(yukiInitializer.IconView) As "TFEI"
    $iconView = New NagatoFilerIconView(yukiInitializer.IconView) 
    
End

Private Function Selection_Read() As String[]

    Return $userInput.Selection

End
