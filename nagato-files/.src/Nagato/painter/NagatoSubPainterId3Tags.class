' Gambas class file

Inherits NagatoSubPainter

Private Function getCollapsedText(argTitle As String, argProperty As String) As String
    
    Dim yukiTitleLength As Integer = Me._$drawingArea.Font.RichTextWidth(argTitle)
    Dim yukiLength As Integer = Me._$drawingArea.W - Me.MarginDouble - yukiTitleLength
    
    Return MikuruCollapsedText.Get(argProperty, Me._$drawingArea.Font, yukiLength)
    
End

Private Sub getId3Tags(argPath As String) As String
    
    Dim yukiId3TagTemplate As String = "<br>&1<br>&2<br>&3<br>"
    Dim yukiTitle As String = MikuruId3TagInfo.GetTitle(argPath)
    Dim yukiArtist As String = MikuruId3TagInfo.GetArtist(argPath)
    Dim yukiAlbum As String = MikuruId3TagInfo.GetAlbum(argPath)
    Dim yukiId3Tag As String
    
    yukiTitle = getCollapsedText("Title: ", yukiTitle)
    yukiArtist = getCollapsedText("Artist: ", yukiArtist)
    yukiAlbum = getCollapsedText("Album: ", yukiAlbum)
    yukiId3Tag = Subst$(yukiId3TagTemplate, yukiTitle, yukiArtist, yukiAlbum)
    
    Return yukiId3Tag
    
End

Public Function Draw(argTopOffset As Integer, argPath As String) As Integer
    
    Dim yukiTemplate As String = "<br>Title:<br>Artist:<br>Album:<br>"
    Dim yukiId3Tags As String = getId3Tags(argPath)
    
    Return Me._DrawProperties(argTopOffset, yukiTemplate, yukiId3Tags)
    
End
