' Gambas class file

Inherits NagatoDesktopPanelContent

Private Function getText(argDesktopWindow As DesktopWindow, argWidth As Integer) As String
    
    Return MikuruCollapsedText.Get(argDesktopWindow.Name, Paint.Font, argWidth)
    
End

Public Sub _PopUpContextMenu(argDesktopWindow As DesktopWindow)
    
    Dim yukiMenu As New NagatoContextMenuPanelTask(HaruhiDesktop, "", argDesktopWindow)
    
    yukiMenu.Popup()
    
End

Public Sub _InitializeObserver()
    
    Me._$observer = New Observer(NagatoDesktopWatcher2) As "Asakura"
    
End

Public Sub _PaintRectangle(argRect As Rect)
    
    With argRect
        Paint.Brush = Paint.Color(Color.Lighter(Color.Orange))
        Paint.Rectangle(.X, .Y, .W, .H)
        Paint.Fill()
    End With
    
Catch
    Return
    
End

Public Sub _PaintText(argDesktopWindow As DesktopWindow, argRect As Rect)
    
    With argRect
        Paint.RichText(getText(argDesktopWindow, .W - 28), .X + 24, .Y, .W - 24, .H, Align.Left)
    End With
    
Catch
    Return
    
End

Public Sub _PaintIcon(argDesktopWindow As DesktopWindow, argRect As Rect)
    
    If argDesktopWindow.Icon Then
        Paint.DrawImage(argDesktopWindow.Icon.Stretch(16, 16), argRect.X + 4, argRect.Y + 4)
    Else
        Paint.DrawPicture(MikuruIcon.Get("question-balloon"), argRect.X + 4, argRect.Y + 4)
    End If
     
Catch
    Return
     
End

Public Sub Asakura_ListChanged()
    
    Me._RefreshAll()
    
End
