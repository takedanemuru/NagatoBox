' Gambas class file

Inherits NagatoDesktopPanelContent

Private $buttons As NagatoPanelButtonsNagatoPlayerX
Private $access As NagatoDBusAccessNagatoPlayerX
Private $painter As NagatoPanelPainterNagatoPlayerX

Private Sub showContextMenu()
    
    Dim yukiMenu As New NagatoContextMenuPanelNagatoPlayerX(HaruhiDesktop, "") As "ContextMenu"
    
    yukiMenu.Popup()
    
End

Public Sub _Close()
    
    $buttons.Visible = False
    
End

Public Sub _Show()
    
    $buttons.Visible = True
    
End

Public Sub _Refresh()
    
    Me._$drawingArea.Refresh()
    
End

Public Sub _new(argContainer As Container, argExpand As Boolean)
    
    $access = New NagatoDBusAccessNagatoPlayerX
    $painter = New NagatoPanelPainterNagatoPlayerX
    
    Me._Initialize(argContainer, argExpand)
    
    $buttons = New NagatoPanelButtonsNagatoPlayerX(argContainer) As "Buttons"
    $buttons.Visible = False
    
End

Public Sub ClockDrawingArea_Draw()

    Paint.Begin(Me._$drawingArea)
        $painter.Refresh(Me._$drawingArea, $access.GetTextMain(), $access.GetTextProgress())
    Paint.End()
    ' 
End

Public Sub ClockDrawingArea_MouseDown()
    
    If Not $access.Enabled Then Return
    
    If Mouse.Right Then showContextMenu()
    
End

Public Sub ContextMenu_Signal(argTag As Integer, argValues As Variant[])
    
    If argValues[0] Then Return
    
    $access.Action(argTag)
    
End

Public Sub Buttons_MenuAction(argAction As Integer)
    
    $access.Action(argAction)
    
End
