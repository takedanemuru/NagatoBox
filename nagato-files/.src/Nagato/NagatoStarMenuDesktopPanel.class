' Gambas class file

Inherits NagatoMenuPipe

Public _$rootMenu As Menu

Public Enum MenuPersona

Event ChangeMode(argMode As Integer)

Private Sub initializeRootMenu(argButton As MenuButton)
    
    Me._$rootMenu = New Menu(HaruhiDesktop) As "RootMenu"
    Me._$rootMenu.Name = "DesktopPanelStarMenu"
    argButton.Menu = "DesktopPanelStarMenu"
    
End

Private Sub addConfigSubMenu()
    
    Dim yukiSubMenu As NagatoSubMenuDesktopPanelConfig
    
    yukiSubMenu = New NagatoSubMenuDesktopPanelConfig(Me._$rootMenu) As "Menu"
    
End

Public Sub _AddMenu(argText As String, argTag As Integer, Optional argIcon As Picture, Optional argShortcut As String)  
    
    Dim yukiMenu As New Menu(Me._$rootMenu) As "MenuItem"
    
    With yukiMenu
        .Text = argText
        .Tag = argTag
        If argIcon Then .Picture = argIcon
        If argShortcut Then .Shortcut = argShortcut
    End With
    
End

Private Sub refreshChildMenus()
    
    Me._AddMenu(("YUKI.N > ..."), MenuPersona, MikuruIcon.Get("question-balloon"))
        Me._AddMenu("", 0)
    addConfigSubMenu()
        Me._AddMenu("", 0)
    With NagatoDesktopPanelContainer
        Me._AddMenu(("Tasks (TypeA)"), .ModeTasksTypeA, MikuruIcon.Get("gear"))
        Me._AddMenu(("Tasks (TypeB)"), .ModeTasksTypeB, MikuruIcon.Get("gears"))
        Me._AddMenu(("System Monitor"), .ModeTaskManager, MikuruIcon.Get("oscilloscope"))
        Me._AddMenu(("RSS"), .ModeRss, MikuruIcon.Get("feed"))
        Me._AddMenu(("Music"), .ModePlayer, MikuruIcon.Get("headphone"))
    End With
    
End

Public Sub _new(argButton As MenuButton)
    
    initializeRootMenu(argButton)
    Me._AddMenu("", 0) ' as dummy menu
    
End

Public Sub RootMenu_Show()
    
    Me._$rootMenu.Children.Clear()
    refreshChildMenus()
    
End

Public Sub MenuItem_Click()
    
    Select Case Last.Tag
        Case MenuPersona
            HaruhiPersona.EnsureVisible()
        Default
            Raise ChangeMode(Last.Tag)
    End Select
    
End
