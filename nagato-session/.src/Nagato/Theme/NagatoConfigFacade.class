' Gambas class file

Create Static

Property Read Status As Integer
Property Read ThemesList As String[]
Property Read WidgetTheme As String
Property Read WidgetThemeMatched As Boolean
Property Read IsThemeUnified As Boolean
Property Read IconTheme As String
Property Read CursorTheme As String

Private $themes As NagatoThemes
Private $configGtk2 As NagatoConfigFile
Private $configGtk3 As NagatoConfigFile
Private $configQt As NagatoConfigFile

Private Function isThemesMatched() As Boolean
    
    If ($configGtk2["", "gtk-theme-name"] <> $configGtk3["Settings", "gtk-theme-name"]) Then Return False
    If $themes.List.Exist($configGtk2["", "gtk-theme-name"]) Then Return True
    
Finally
    Return False
    
End

Public Sub Set()
    
    If Not NagatoInterimStatus.IconTheme Then Return
    $configGtk2["", "gtk-icon-theme-name"] = NagatoInterimStatus.IconTheme
    $configGtk3["Settings", "gtk-icon-theme-name"] = NagatoInterimStatus.IconTheme
    
End

Public Sub _new()
    
    $themes = New NagatoThemes
    $configGtk2 = New NagatoConfigFile(User.Home &/ ".gtkrc-2.0", False)
    $configGtk3 = New NagatoConfigFile(Desktop.ConfigDir &/ "gtk-3.0" &/ "settings.ini", True)
    $configQt = New NagatoConfigFile(Desktop.ConfigDir &/ "Trolltech.conf", True)
    
End

Private Function ThemesList_Read() As String[]

    Return $themes.List

End

Private Function WidgetTheme_Read() As String

    Return IIf(isThemesMatched(), $configGtk2["", "gtk-theme-name"], Null)

End

Private Function WidgetThemeMatched_Read() As Boolean

    Return isThemesMatched()

End

Private Function IsThemeUnified_Read() As Boolean

    IIf($configQt["Qt", "style"] = "GTK+", True, False)

End

Private Function Status_Read() As Integer

    If $themes.Count = 0 Then Return MikuruConfig.NotFound
    If isThemesMatched() Then Return MikuruConfig.Matched
       
    Return MikuruConfig.NotMatched
    
End

Private Function IconTheme_Read() As String

    Return $configGtk2["", "gtk-icon-theme-name"] 

End

Private Function CursorTheme_Read() As String

    Return $configGtk2["", "gtk-cursor-theme-name"] 

End
