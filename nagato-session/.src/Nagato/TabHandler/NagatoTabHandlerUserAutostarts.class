' Gambas class file

Inherits NagatoTabHandler

Private $panel As NagatoMenuPanelUserAutostarts
Private $tableView As TableView
Private $tableViewHandler As NagatoTableAutostarts
Private $observer As Observer

Private Function getHeader(argColumn As Integer) As String
    
    Select Case argColumn
        Case 2
            Return "Exec"
        Case 3
            Return "TryExec"
        Case 4
            Return "NotShowIn"
        Case 5
            Return "OnlyShowIn"
        Default
            Return ""
    End Select
    
End

Public Sub _InitializePanel()
    
    $panel = New NagatoMenuPanelUserAutostarts(Me._$container) As "TFEI"
    $observer = New Observer(NagatoEventBridgeOnlyShowIn) As "Asakura"
    
End

Public Sub _InitializeGridView()
    
    $tableView = New TableView(Me._$container) As "TableView"
    $tableViewHandler = New NagatoTableAutostarts($tableView, NagatoXdgAutostarts.UserAutoStarts)
    NagatoSettingsGridView.Load($tableView)
    
End

Public Sub SaveSettings()
    
    NagatoSettingsGridView.Save($tableView)
    
End

Public Sub TableView_Click()
    
    Dim yukiList As String[]
    
    Select Case $tableView.Column
        Case 2, 3
            $tableView.Edit()
        Case 4
            yukiList = NagatoXdgAutostarts.UserAutoStarts.All[$tableView.Row].NotShowIn
            HaruhiDialogOnlyShowIn.Set(yukiList, $tableView.Column, $tableView.Row)
        Case 5
            yukiList = NagatoXdgAutostarts.UserAutoStarts.All[$tableView.Row].OnlyShowIn
            HaruhiDialogOnlyShowIn.Set(yukiList, $tableView.Column, $tableView.Row)
    End Select
    
End

Public Sub TableView_Save(argRow As Integer, argColumn As Integer, argValue As String)
    
    Dim yukiPath As String = NagatoXdgAutostarts.UserAutoStarts.All[$tableView.Row].Path
    Dim yukiEditor As New NagatoDesktopEntryEditor(yukiPath)
    
    yukiEditor.SetString(getHeader(argColumn), argValue)
    $tableView[argRow, argColumn].Text = argValue
    
Catch
    Debug argRow
    Debug argColumn
    
End

Public Sub TableView_Menu()
    
    Dim yukiContextMenu As NagatoContextMenuUserAutostarts
    Dim yukiAutostartFile As NagatoAutostartFile
    
    If $tableView.Rows.Selection.Count = 0 Then Return
    
    yukiAutostartFile = NagatoXdgAutostarts.UserAutoStarts.All[$tableView.Row]
    yukiContextMenu = New NagatoContextMenuUserAutostarts(yukiAutostartFile) As "TFEI"
    yukiContextMenu.Popup()
    
End

Public Sub Reload()
    
    $tableViewHandler.Refresh(NagatoXdgAutostarts.UserAutoStarts)
    
End

Public Sub TFEI_Signal(argSignal As Integer, argValues As Variant[])
    
    Select Case argSignal
        Case MikuruSignal.AutostartsNew
            HaruhiApplications.ShowDialog()
        Case MikuruSignal.AutostartsDelete
            MikuruDialogPortalDeleteAutostart(argValues[0].Path)
    End Select
    
End

Public Sub Asakura_DataChanged(argData As String, argColumn As Integer, argRow As Integer)
    
    Me.TableView_Save(argRow, argColumn, argData)
    
End
