' Gambas class file

Private Const BusName As String = "org.gambas.nagato-files"
Private Const ObjectPath As String = "/org/nagato/files"
Private Const Interface As String = "org.gambas.nagato.files.nagatointerfacedesktop"

Private $message As String
Private $position As Integer

Event RequestClose

Private Function getCursor() As String
    
    Return IIf(Odd($position Div 2), "", "_")
    
End

Private Sub checkClosable()
    
    If String.Len($message) + 40 > $position Then Return
    If Not DBus.Session.Applications.Exist(BusName) Then Return
    If Not DBus[BusName][ObjectPath, Interface].Ready Then Return
    
    Raise RequestClose
    
End

Public Function Get() As String
    
    Dim yukiMessage As String = "YUKI.N > " & String.Left($message, $position) & getCursor()
    
    Inc $position
    checkClosable()
    
    Return yukiMessage
    
End

Public Sub _new()
    
    $message = ("Can you see this ?")
    
End
