' Gambas module file

Public Enum TypeExit, TypeReboot, TypeShutdown, TypeLockScreen

Private Const BusName As String = "system://org.freedesktop.login1"
Private Const ObjectPath As String = "/org/freedesktop/login1"
Private Const Interface As String = "org.freedesktop.login1.Manager"

Public Function IsOpenbox() As Boolean
    
    Dim yukiOutput As String
    
    Shell "printenv | grep DESKTOP_SESSION" To yukiOutput
    
    If (yukiOutput Ends "openbox\n") Then
        Return True
    Else If (yukiOutput Ends "NagatoBox\n") Then
        Return True
    Else
        Return False
    Endif
    
End

Public Function IsNagatoBox() As Boolean
    
    Dim yukiOutput As String
    
    Shell "printenv | grep DESKTOP_SESSION" To yukiOutput
    
    If (yukiOutput Ends "NagatoBox\n") Then
        Return True
    Else
        Return False
    Endif
    
End

Public Sub Logout(argType As Integer)
    
    Dim yukiDBusProxy As DBusProxy = DBus[BusName][ObjectPath, Interface]
    
    Select Case argType
        Case TypeExit
            Shell Subst$("openbox --exit && loginctl kill-user &1", User.Id)
        Case TypeReboot
            yukiDBusProxy.Reboot(False)
        Case TypeShutdown
            yukiDBusProxy.PowerOff(True)
        Case TypeLockScreen
            Try Shell "nagato-config-screenlocker -l"
    End Select
    
End
