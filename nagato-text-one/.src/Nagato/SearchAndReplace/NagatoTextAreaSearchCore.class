' Gambas class file

Inherits NagatoWidgetHandler

Public Function _GetCurrentPositionInUTF8(argQuery As String) As Integer
    
    Dim yukiSearchStartFrom As Integer = String.Len(Left$(Me._$widget.Text, Me._$widget.Pos))
    Dim yukiPosition As Integer = String.InStr(Me._$widget.Text, argQuery, yukiSearchStartFrom + 1, gb.IgnoreCase)

    If yukiPosition = 0 Then yukiPosition = String.InStr(Me._$widget.Text, argQuery, 0, gb.IgnoreCase)
    
    Return yukiPosition - 1
    
End

Public Sub _SearchText(argText As String)
    
    Dim yukiStartPosition As Integer = Me._GetCurrentPositionInUTF8(argText)
    
    If yukiStartPosition = -1 Then Return
    
    Me._$widget.Select(yukiStartPosition, String.Len(argText))
    
End

Public Function _HasQuery(argQuery As String) As Boolean
    
    If MikuruText.GetReplacementCount(Me._$widget.Text, argQuery) = 0 Then
        Message.Error(("Query not found"))
        Return False
    Else
        Return True
    Endif
    
End
