' Gambas class file

Private $cache As New Collection
Private $temporaryElement As NagatoWeatherElement

Private Sub getLocalTime(argUTCTime As String) As String
    
    Return MikuruReadableTime.GetLocaleTime(argUTCTime)
    
End

Private Sub setData(argXmlElement As XmlElement)
    
    If argXmlElement.Attributes["from"] = argXmlElement.Attributes["to"] Then
        $temporaryElement = New NagatoWeatherElement
        $temporaryElement.SetEssentialData(argXmlElement)
    Else If Object.IsValid($temporaryElement) And If Not $temporaryElement.HasIcon Then
        $temporaryElement.SetAdditionalData(argXmlElement)
        $cache.Add($temporaryElement, getLocalTime(argXmlElement.Attributes["to"]))
    Endif
    
End

Private Sub parseXml(argElements As XmlElement[])
    
    Dim yukiXmlElement As XmlElement
    
    For Each yukiXmlElement In argElements
        setData(yukiXmlElement)
    Next
    
End

Public Function Refresh(argElements As XmlElement[]) As Collection
    
    $cache.Clear()
    parseXml(argElements)
    
    Return $cache
    
End
