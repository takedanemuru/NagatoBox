' Gambas class file

Private $httpClient As New NagatoHttpClientUserLocation As "HttpClient"
Private $cache As New NagatoXmlCacheUserLocation

Public Sub HttpClient_Finished()
    
    Dim yukiGeoElement As NagatoGeoElement
    
    $cache.ResetCache($httpClient.Buffer)
    
    For Each yukiGeoElement In $cache.Cache
        LocationsListView.Add(yukiGeoElement.VisibleName, yukiGeoElement.VisibleName)
    Next
    
End

Public Sub form_Open()
    
    With LocationLabel
        .Text = NagatoSettings.UserLocationLabelText
        .Height = .Font.RichTextHeight(.Text) + 16
    End With
    
End

Public Sub FindButtonBox_Click()
    
    With FindButtonBox
        If .Text = "" Then Return
        LocationsListView.Clear()
        $httpClient.Activate(.Text)
    End With
    
End

Public Sub FindButtonBox_Activate()

    FindButtonBox_Click()

End

Public Sub LocationsListView_Activate()
    
    NagatoSettings.ChangeUserLocation($cache[LocationsListView.Key])
    Me.Close(MikuruDialog.ResponseApply)
    
End
