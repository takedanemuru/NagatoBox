' Gambas class file

Private $httpClient As New NagatoHttpClientUserLocation As "HttpClient"
Private $cache As New NagatoXmlCacheUserLocation
Private $label As NagatoLocationTextLabel
Private $searchBox As NagatoSearchBox
Private $grids As NagatoGridsHandlerLocations

Public Sub HttpClient_Finished()
    
    Dim yukiGeoElement As NagatoGeoElement
    
    $cache.ResetCache($httpClient.Buffer)
    
    For Each yukiGeoElement In $cache.Cache
        $grids.SetData(yukiGeoElement)
    Next
    
End

Public Sub Form_Open()
    
    NagatoSettingsForm.Load(Me)
    $label = New NagatoLocationTextLabel(Me)
    $searchBox = New NagatoSearchBox(Me) As "SearchBox"
    $grids = New NagatoGridsHandlerLocations(Me) As "Grids"
    
End

Public Sub Form_Close()
    
    NagatoSettingsForm.Save(Me)
    
End

Public Sub SearchBox_Activated(argQuery As String)
    
    $grids.Clear()
    $httpClient.Activate(argQuery)
    
End

Public Sub Grids_Activate(argLocationName As String)
    
    NagatoSettingsLocation.ChangeUserLocation($cache[argLocationName])
    Me.Close(MikuruDialog.ResponseApply)
    
End
