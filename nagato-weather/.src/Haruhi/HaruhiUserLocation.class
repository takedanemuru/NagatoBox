' Gambas class file

Private $httpClient As New NagatoHttpClientUserLocation As "HttpClient"
Private $cache As New NagatoXmlCacheUserLocation
Private $label As NagatoLocationTextLabel
Private $searchBox As NagatoSearchBox
Private $grids As NagatoGridViewLocations

Private Sub refreshGridView()
    
    Dim yukiGeoElement As NagatoGeoElement
    
    $grids.Clear()
    
    For Each yukiGeoElement In $cache.Cache
        $grids(yukiGeoElement)
    Next
    
End

Public Sub HttpClient_Finished()
    
    $cache.ResetCache($httpClient.Buffer)

    If $cache.Cache.Count = 0 Then 
        Message.Error(("YUKI.N > Location not found."), ("OK"))
    Else
        refreshGridView()
    Endif
    
End

Public Sub Form_Open()
    
    NagatoSettingsForm.Load(Me)
    $label = New NagatoLocationTextLabel(Me)
    $searchBox = New NagatoSearchBox(Me) As "SearchBox"
    $grids = New NagatoGridViewLocations(Me) As "Grids"
    
End

Public Sub Form_Close()
    
    NagatoSettingsForm.Save(Me)
    
End

Public Sub Grids_Activate(argLocationName As String)
    
    NagatoSettingsLocation.ChangeUserLocation($cache[argLocationName])
    Me.Close(MikuruDialog.ResponseApply)
    
End

Public Sub SearchBox_Activated(argQuery As String)
    
    $httpClient(argQuery)
    
End
