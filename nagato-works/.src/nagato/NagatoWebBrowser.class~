' Gambas class file

Inherits NagatoTabContent

Private $toolBar As NagatoWebBrowserToolBar
Private $webView As NagatoWebBrowserWebView
Private $searchBar As NagatoInfobarSearch

Public Sub _new(argTabStrip As TabStrip, Optional argUrl As String = "")
    
    NagatoSettingsCore.LoadWebSettings()
    Me._Initialize(argTabStrip)
    $toolBar = New NagatoWebBrowserToolBar(Me._$hBox) As "ToolBar"
    $webView = New NagatoWebBrowserWebView(Me._$vBox, argUrl) As "NagatoWebView"
    $searchBar = New NagatoInfobarSearch(Me._$vBox) As "SearchBar"
    
End

Public Sub ToolBar_HomePage()
    
    $webView.HomePage()
    
End

Public Sub ToolBar_Back()
    
    $webView.Back()
    
End

Public Sub ToolBar_Forward()
    
    $webView.Forward()
    
End

Public Sub ToolBar_Reload()
    
    $webView.Reload()
    
End

Public Sub ToolBar_Stop()
    
    $webView.Stop()
    
End

Public Sub ToolBar_NewUrl(argUrl As String)
    
    $webView.Url = argUrl
    NagatoDBWeb.PushHistory($webView.Url, $webView.Title)
    
End

Public Sub ToolBar_NewBrowser(argUrl As String)
    
    NagatoTabHandler.NewTabWithPath(MikuruFunctionType.WebBrowser, argUrl)
    
End

Public Sub ToolBar_SetHomePage()
    
    NagatoSettingsWeb.HomePage = $webView.Url
    
End

Public Sub ToolBar_AddBookmark()

    With HaruhiAddWebBookmark
        .Center()
        .SetTitle($webView.Title)
        If NagatoDBWeb.CategoryCount > 0 Then .SetList(NagatoDBWeb.CategoryNames)
        If HaruhiAddWebBookmark.ShowDialog() = 1 Then
            NagatoDBWeb.PushBookmark($webView.Url, $webView.Title, .UserTitle, .Category)
            NagatoWebbookmarkCache.RefreshCategory(.Category)
        Endif
    End With

End

Public Sub ToolBar_EditPage()
    
    Dim yukiPath As String = Temp$()
    
    File.Save(yukiPath, $webView.Html)
    NagatoTabHandler.NewTabWithPath(MikuruFunctionType.HighlightEditor, yukiPath)
    
End

Public Sub SearchBar_FindText(argStringsToSerch As String)
    
    $webView.FindText(argStringsToSerch)
    
End

Public Sub NagatoWebView_NewBrowser(argPath As String)
    
    NagatoTabHandler.NewTabWithPath(MikuruFunctionType.WebBrowser, argPath)
    
End

Public Sub NagatoWebView_NewUrl(argUrl As String)
    
    $toolBar.SetUrl(argUrl)
    
End

Public Sub NagatoWebView_NewIcon(argIcon As Picture)
    
    Me._RefreshParentTabPicture(argIcon)
    
End

Public Sub NagatoWebView_NewTitle(argTitle As String)
    
    Me._RefreshParentTabTitle(argTitle)
    
End

Public Sub NagatoWebView_MoveToSearchBox()
    
    $searchBar.Show()
    
End

Public Sub NagatoWebView_InProgress()
    
    $toolBar.SetButton(NagatoWebViewButtons.ButtonHalt)
    
End

Public Sub NagatoWebView_Done()
    
    $toolBar.SetButton(NagatoWebViewButtons.ButtonReload)
    
End
