' Gambas class file

Create Static

Private Function getMimeTypeWithFile(argFullPath As String) As String
    
    Dim yukiResult As String
    
    Shell Subst("file --mime-type &1", argFullPath) To yukiResult
    
    yukiResult = Replace$(yukiResult, argFullPath & ": ", "")
    yukiResult = Replace$(yukiResult, "\n", "")
    
    Return Replace$(yukiResult, Subst$("&1: ", argFullPath), "")
    
End

Public Sub GetMineType(argFullPath As String) As String 
    
    Return DesktopMime.FromFile(argFullPath).Type
    
Catch
    Return getMimeTypeWithFile(argFullPath)

End

Public Function GetDesktopFiles(argFullPath As String) As Object[] ' This function should return DesktopFile[]
    
    Return DesktopFile.FromMime(GetMineType(argFullPath))
    
End

Public Function IsMatchedMimeType(argFullPath As String) As Boolean ' Return true when MimeType  matches specified MimeType
    
    Dim yukiMimeType As String = Me.GetMineType(argFullPath)
    
    With NagatoSettingsFileSearch
        If .MimeFilterText And If yukiMimeType Begins "Text" Then Return True 
        If .MimeFilterMusic And If yukiMimeType Begins "Audio" Then Return True
        If .MimeFilterImage And If yukiMimeType Begins "Image" Then Return True
        If .MimeFilterVideo And If yukiMimeType Begins "Video" Then Return True
    End With
    
    Return False
    
End

Public Function HandlingApplicationsCount(argFullPath As String) As Integer
    
    Dim yukiMime As String = DesktopMime.FromFile(argFullPath).Type
    
    Return MikuruConfFlie.GetItems("/usr/share/applications/mimeinfo.cache", yukiMime).Count
    
Catch
    Return 0
    
End
