' Gambas module file

Private Const TitleHeader As String = "=== TIT2 (Title/songname/content description): "

Private Function getData(argFullPath As String) As String[]
    
    Dim yukiCommand As String = Subst$("id3info &1", Quote$(argFullPath))
    Dim yukiResult As String
    
    Shell yukiCommand To yukiResult
    
    Return Split(yukiResult, "\n", "", True)
    
End

Private Function getId3v2TagTitle(argFullPath As String) As String
    
    Dim yukiLine As String
    
    For Each yukiLine In getData(argFullPath)
        If InStr(yukiLine, TitleHeader) <> 0 Then 
            If InStr(yukiLine, "???") <> 0 Then Break
            Return Replace$(yukiLine, TitleHeader, "")
        Endif
    Next
    
    Return File.BaseName(argFullPath)
    
End

Public Function GetTitle(argFullPath As String) As String
    
    If Not Exist(argFullPath) Then
        Return ""
    Else
        Return getId3v2TagTitle(argFullPath)
    End If
    
End

