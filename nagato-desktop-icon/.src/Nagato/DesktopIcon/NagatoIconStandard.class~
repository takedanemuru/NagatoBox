' Gambas class file

Inherits NagatoIcon

Create Private

Property Read FormHeight As Integer

Public Const IconSize As Integer = 64

Public _$path As String
Public _$mime As String
Public _$icon As Image
Public _$text As String
Public _$textHeight As Integer
Public _$textArea As New Rect

Public Function _GetText() As String 'virtual
    
    
    
End

Public Sub _OnActivate() 'virtual 
    
    
    
End

Public Function _GetMime() As String
    
    Return Desktopmime.FromFile(Me._$path).Type
    
End

Public Sub _OnMouseEnter()
    
    Me._SetFormPicture(NagatoSettings.BackgroundHighlight)
    
End

Public Sub _OnMouseLeave()
    
    Me._SetFormPicture(NagatoSettings.BackgroundFile)
    
End

Public Sub _SetTextRect()
    
    With Me._$textArea
        .X = Me.Margin
        .Y = Me._$icon.H + 2 * Me.Margin
        .W = Me.FormWidth - 2 * Me.Margin 
        .H = Me._$textHeight 
    End With
    
End

Public Sub _DrawText()
    
    Paint.Brush = Paint.Color(Color.White)
    Paint.Font.Bold = True
    With Me._$textArea
        Paint.RichText(Me._$text, .X, .Y, .W, .H, Align.Center)
    End With
    Paint.Fill()
    
End

Public Sub _SetFormPicture(argBackground As Integer) 
    
    Dim yukiBaseImage As New Image(Me._$form.W, Me._$form.H, argBackground)
    
    With paint
        .Begin(yukiBaseImage)
        .DrawImage(Me._$icon, (Me._$form.W - Me._$icon.W) / 2, Me.Margin)
        Me._DrawText()
        .End()
    End With
    
    Me._$form.Picture = yukiBaseImage.Picture
    
End

Public Sub _SetIcon() 
    
    Me._$icon = Desktop.GetFileIcon(Me._$path, Me.IconSize).Image
    
End

Public Sub _SetForm()
    
    Me._InitializeForm(Me.FormHeight)
    
    Me._$form.Name = File.Name(Me._$path)
        
End

Public Sub _new(argName As String)
    
    Me._$path = MikuruPath.Desktop &/ argName
    Me._$mime = Me._GetMime()
    Me._$text = Me._GetText()
    Me._$form = New Form As "Icon"
    Me._$form.Font.Bold = True
    Me._SetIcon()
    Me._$textHeight = Me._$form.Font.RichTextHeight(Me._$text, Me.TextWidth)
    Me._SetTextRect()
    Me._SetForm()
    Me._SetFormPicture(NagatoSettings.BackgroundFile)
    Me._$form.Show()
    Me._$form.Drop = True
    
End

Public Sub Icon_MouseDrag()
    
    Drag.Icon = Me._$form.Picture
    Me._$form.Drag("nagato", "text/nagato-desktop-icon")
    
End

Public Sub Icon_Drop()
    
    Debug Drag.Data
    
End

Public Sub Icon_DblClick()
    
    Me._OnActivate()
    
End

Private Function FormHeight_Read() As Integer

    Return Me._$icon.H + Me._$textHeight + 3 * Me.Margin

End
