' Gambas class file

Inherits NagatoIcon

Private $text As String = "network"
Private $observer As Observer

Private Function getText() As String
    
    Dim yukiText As String 
    
    If NagatoNetworkManager.Connectable Then
        yukiText = NagatoNetworkManager.Devices[0].ReadableType
        yukiText &= Subst$("<br>&1", Format$(NagatoNetworkManager.Devices[0].Speed / 1000, "#0.00Mbps"))
    Else
        yukiText = NagatoNetworkManager.ReadableState
    Endif
    
    Return yukiText
    
End

Private Sub setFormPicture(Optional argBackground As Integer = Color.Lighter(Color.Blue))
    
    Dim yukiBaseImage As Image
    
    Me._$form.Height = Me._$form.Font.RichTextHeight($text, Me.TextWidth) + 72
    yukiBaseImage = New Image(Me.FormWidth, Me._$form.Height, argBackground)
    
    Paint.Begin(yukiBaseImage)
        Paint.Brush = Paint.Color(Color.White)
        Paint.DrawImage(MikuruIcon.Get("wireless-router", 48).Image, 40, Me.Margin)
        Paint.Font.Bold = True
        Paint.DrawRichText($text, Me.Margin, 64, Me.TextWidth, Me._$form.Height - 72, Align.Center)
    Paint.End()
    
    Me._$form.Picture = yukiBaseImage.Picture
    
End

Public Sub _new()
    
    NagatoNetworkManager.EnsureActivation()
    
    Me._$form = New Form As "Icon"
    $text = getText()
    Me._InitializeForm(Me._$form.Font.RichTextHeight($text) + 72)
    Me._$form.Show
    setFormPicture()
    
    $observer = New Observer(NagatoNetworkManager) As "Asakura"
    
End

Public Sub Asakura_PropertiesChanged()
    
     $text = getText()
    setFormPicture()
    
End
