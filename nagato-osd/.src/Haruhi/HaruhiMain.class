' Gambas class file

Private Const Type As String = "_NET_WM_WINDOW_TYPE"
Private Const TypeDesktop As String = "_NET_WM_WINDOW_TYPE_DESKTOP"

Private $timer As New Timer As "Timer"
Private $painter As NagatoPainter
Private $contextMenu As New NagatoContextMenu As "ContextMenu"

Private Sub setAsRoot(argWindowId As Integer) 
    
    Try Shell Subst("xprop -id &1 -f &2 32a -set &2 &3", argWindowId, Type, TypeDesktop) Wait
    
End

Public Sub Form_Open()
    
    Me.W = NagatoSettingsForm.Width
    Me.H = Screen.AvailableHeight
    Me.X = Screen.W - Me.W
    Me.Y = 0
    setAsRoot(Me.Id)
    Me.Arrangement = Arrange.Fill
    $painter = New NagatoPainter(Me)
    $timer.Enabled = True
    
    Application.MainWindow = Me
    
End

Public Sub Timer_Timer()
    
    $painter()
    
End

Public Sub Form_Close()
    
    $timer.Enabled = False
    
    Try Shell "nagato-rss-daemon --check-out nagato-osd"
    
    NagatoDBus.Unregister()
    
End

Public Sub Form_Menu()

    $contextMenu.PopUp()

    'If MikuruHidden.DesktopType = "openbox" Then Shell "xdotool key super+space"

End
