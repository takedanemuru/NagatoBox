' Gambas class file

Property Read Enabled As Boolean

Public Enum ActionNone, ActionPlay, ActionPause, ActionNext, ActionBack, ActionAddMusics

Private Const ServiceName As String = "org.gambas.nagato-player-x"
Private Const ObjectPath As String = "/org/nagato/player/x/player"
Private Const InterfaceName As String = "org.gambas.nagato.player.x.nagatodbusinterface"
Private Const ObjectPath2 As String = "/org/nagato/player/x/property"
Private Const InterfaceName2 As String = "org.gambas.nagato.player.x.nagatodbusinterfaceproperty"

Private $player As DBusProxy
Private $property As DBusProxy

Private Sub ensureProxy()
    
    If Not Object.IsValid($player) Then $player = DBus[ServiceName][ObjectPath, InterfaceName]
    If Not Object.IsValid($property) Then $property = DBus[ServiceName][ObjectPath2, InterfaceName2]
    
End

Public Function GetCoverArtPath() As String
    
    Return $property.CoverArtPath
    
End

Public Sub GetTitle() As String
    
    Return $property.Title
    
End

Public Function GetText() As String
    
    Dim yukiText As String 
    
    If DBus.Session.Applications.Exist(ServiceName) Then
        yukiText &= ($property.Title) 
        If $property.Artist Then yukiText &= ("<br>" & $property.Artist)
        'If $property.Album Then yukiText &= ("<br>" & $property.Album)
        Return yukiText
    End If
    
Finally
    Return "YUKI.N > nagato-player-x is not activated"
    
End

Public Sub GetTextProgress() As String
    
    If DBus.Session.Applications.Exist(ServiceName) Then
        Return ($property.ProgressInText)
    End If
    
Finally
    Return ""
    
End

Public Sub _new()
    
    ensureProxy()
    
End

Private Function Enabled_Read() As Boolean

    Return DBus.Session.Applications.Exist(ServiceName)

End
