' Gambas class file

Private $painterText As New NagatoPainterText
Private $painterHeader As New NagatoPainterHeader
Private $painterImage As New NagatoPainterImage2
Private $proxyRss As New NagatoDBusAccessRssFeeder
Private $thumbnail As New NagatoRssThumbnail

Private Sub showThumbnail(argY As Integer, argTitle As String) As Integer
    
    Dim yukiY As Integer = argY + 4
    
    If $thumbnail.HasThumbnail(argTitle) Then
        yukiY = $painterImage(yukiY, $thumbnail.GetThumbnailPath(argTitle), 150)
    Endif
    
    If (Second(Now()) + 10) Mod 15 = 0 Then $thumbnail.SetUrl($proxyRss.GetFeedItem(1))
    
    Return yukiY + 4
    
End

Private Sub paintNews(argY As Integer) As Integer
    
    Dim yukiY As Integer = argY + 4
    Dim yukiItemNumber As Integer = 0
    Dim yukiItemType As Integer = NagatoDBusAccessRssFeeder.RssDescription
    
    Do 
        yukiY = $painterText(yukiY, $proxyRss[yukiItemNumber, yukiItemType], Align.TopLeft)
        If yukiY > HaruhiMain.H Then Break
        yukiY = $painterText(yukiY, " ---- ", Align.Top)
        If yukiY > HaruhiMain.H Then Break
        Inc yukiItemNumber
    Loop
    
    Return yukiY
    
End

Public Sub _call(argY As Integer) As Integer
    
    Dim yukiY As Integer = argY
    
    Paint.Font.Size = 11
    yukiY = $painterHeader(yukiY + 4, "News")
    Paint.Font.Size = 9
    If $proxyRss.Activated Then
        yukiY = showThumbnail(yukiY, $proxyRss[0, 0])
        yukiY = paintNews(yukiY)
    Else
        yukiY = $painterText(yukiY, "please wait ...")
        Try $proxyRss.Activate()
    End If
    If (Second(Now()) + 1) Mod 15 = 0 Then $proxyRss.Next()

    Return yukiY
    
End
