' Gambas class file

Private Const SourcePath As String = "/home/takedanemuru/Anne_Happy.mp3"
Private $player As New NagatoPlayer
Private $inputPath As String
Private $outputPath As String

Public Sub Form_Open()

    Application.MainWindow = Me

End

Public Sub InputPreviewButton_Click()

    If Not Exist($inputPath) Then Return
    
    If $player.State = Media.Playing Then
        InputPreviewButton.Text = ("Preview")
        $player.Stop()
    Else
        InputPreviewButton.Text = ("Stop")
        $player.Play($inputPath)
    End If

End

Public Sub ExecuteButton_Click()

    If Not Exist($inputPath) Then Return

    Select Case EffectsComboBox.Index
        Case 0
            $outputPath = MikuruEffects.Karaoke($inputPath)
        Case 1
            $outputPath = MikuruEffects.Silence($inputPath)
        Case 2
            $outputPath = MikuruEffects.Loudness($inputPath)
    End Select

End

Public Sub OutputPreviewButton_Click()

    If Not Exist($outputPath) Then Return
    
    If $player.State = Media.Playing Then
        InputPreviewButton.Text = ("Preview")
        $player.Stop()
    Else
        InputPreviewButton.Text = ("Stop")
        $player.Play($outputPath)
    End If

End

Public Sub InputPreviewButton2_Click()

    Dialog.Title = ("Select Audio File")
    Dialog.Path = User.Home
    If Dialog.OpenFile(False) Then Return
    $player.Stop()
    $inputPath = Dialog.Path

End

Public Sub SaveButton_Click()

    If Not Exist($outputPath) Then Return
    
    Try $player.Stop()
    
    Dialog.Title = ("Save File")
    Dialog.Path = $inputPath
    If Dialog.SaveFile() Then Return

    Copy $outputPath To Dialog.Path

End
