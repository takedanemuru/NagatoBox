' Gambas class file

Create Static

Private Function isValidPath(argPath As String) As Boolean
    
    If argPath = "" Then Return False
    If Not Exist(argPath) Then Return False
    
    Return True
    
End

Private Sub reloadNagatoDesktopWallpaper()
    
    Dim yukiBusName As String = "Session://org.gambas.nagato-files"
    Dim yukiObjectPath As String = "/org/nagato/files"
    Dim yukiInterface As String = "org.gambas.nagato.files.nagatointerfacedesktop"
    
    Try DBus[yukiBusName][yukiObjectPath, yukiInterface].ReloadDesktopWallpaper()
    
End

Private Sub reloadWallpaper()
    
    If NagatoDBus.IsNagatoDesktopActivated() Then reloadNagatoDesktopWallpaper()

    Shell Subst$("hsetroot &1 &2", "-center", MikuruHidden.PathModefiedImage)
    
End

Public Sub Set()
    
    If Not isValidPath(NagatoPreviewProperties.Path) Then Return
    
    MikuruOriginalImage.SetPath(NagatoPreviewProperties.Path)
    MikuruModefiedImage.Set(NagatoPreviewProperties.Mode)
    
    reloadWallpaper()
    
End

Public Sub SetLast()
    
    If Not NagatoDBus.isNagatoDesktopActivated() Then
        Shell Subst$("hsetroot &1 &2", "-center", MikuruHidden.PathModefiedImage)
    End If
    
End
