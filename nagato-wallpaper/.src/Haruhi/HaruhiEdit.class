' Gambas class file

Property Read PreviewDA As DrawingArea

Private Sub initializeWidgets()
    
    ColorButton.Color = NagatoPreview.Color
    PreviewDrawingArea.Height = Screen.Height * NagatoPreview.Ratio
    ModeComboBox.Index = NagatoSettings.LastMode
    CalendarComboBox.Index = NagatoSettings.LastCalendarPosition
    
End

Public Sub SetPath(argPath As String)
    
    NagatoPreview.Path = argPath
    PreviewDrawingArea.Refresh()
    NagatoSettings.PushToRecentPaths(argPath)
    
End

Public Sub Form_Open()

    Application.MainWindow = Me
    Me.Center()
    NagatoPreview.LoadLastProperties()
    initializeWidgets()
    
End

Public Sub ApplyButton_Click()

    If NagatoPreview.Path = "" Then
        Return
    Else
        NagatoWallpaper.Set(NagatoPreview.Path, NagatoPreview.Color, ModeComboBox.Index)
        NagatoSettings.Refresh(ModeComboBox.Index, CalendarComboBox.Index)
    End If

    Message.Info("YUKI.N > It 's done.", ("OK"))

End

Public Sub SelectButton_Click()

    If HaruhiFileChooser.ShowDialog() = MikuruDialog.ResponseSelected Then
        NagatoPreview.Path = MikuruDialog.Path
        PreviewDrawingArea.Refresh()
        NagatoSettings.PushToRecentPaths(MikuruDialog.Path)
    Endif

End

Public Sub PreviewDrawingArea_Draw()
    
    If NagatoPreview.Path = "" Then Return
    If Not Exist(NagatoPreview.Path) Then Return
    
    PreviewDrawingArea.Background = NagatoPreview.Color

    Paint.Begin(PreviewDrawingArea)
        NagatoThumbnail.Set(ModeComboBox.Index)
    Paint.End()
    
End

Public Sub ColorButton_Change()

    ColorButton.Foreground = ColorButton.Color
    PreviewDrawingArea.Background = ColorButton.Color
    NagatoPreview.Color = ColorButton.Color

End

Public Sub ModeComboBox_Click()

    PreviewDrawingArea.Refresh()

End

Public Sub PreviewDrawingArea_Drop()

    ' PreviewDrawingArea can accept only "text/uri-list"

    If Drag.Type = Drag.Text And If MikuruDrag.CanAccept(Drag.Data) Then
        NagatoPreview.Path = MikuruDrag.GetDragPath(Drag.Data)
        PreviewDrawingArea.Refresh()
    End If

End

Private Function PreviewDA_Read() As DrawingArea

    Return PreviewDrawingArea

End

Public Sub CalendarComboBox_Click()

    NagatoPreview.CalendarPosition = CalendarComboBox.Index

End
