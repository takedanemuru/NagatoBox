' Gambas class file

Property Read Mode As Integer

Private $drawingArea As NagatoPreviewDrawingArea

Private Sub initializeWidgets()
    
    $drawingArea = New NagatoPreviewDrawingArea(PreviewDrawingArea)
        
    BackgroundColorButton.Color = NagatoPreview.Color
    ModeComboBox.Index = NagatoSettings.LastMode
    
End

Public Sub SetPath(argPath As String)
    
    NagatoPreview.Path = argPath
    PreviewDrawingArea.Refresh()
    NagatoSettings.PushToRecentPaths(argPath)
    
End

Public Sub Form_Open()

    Application.MainWindow = Me
    Me.Center()
    NagatoPreview.LoadLastProperties()
    initializeWidgets()
    
End

Public Sub ApplyButton_Click()

    If NagatoPreview.Path = "" Then
        Return
    Else
        NagatoWallpaper.Set(NagatoPreview.Path, NagatoPreview.Color, ModeComboBox.Index)
        NagatoSettings.Refresh(ModeComboBox.Index)
    End If

    Message.Info("YUKI.N > It 's done.", ("OK"))

End

Public Sub SelectButton_Click()

    If HaruhiFileChooser.ShowDialog() = MikuruDialog.ResponseSelected Then
        NagatoPreview.Path = MikuruDialog.Path
        PreviewDrawingArea.Refresh()
        NagatoSettings.PushToRecentPaths(MikuruDialog.Path)
    Endif

End

Public Sub BackgroundColorButton_Change()

    BackgroundColorButton.Foreground = BackgroundColorButton.Color
    PreviewDrawingArea.Background = BackgroundColorButton.Color
    NagatoPreview.Color = BackgroundColorButton.Color

End

Public Sub ModeComboBox_Click()

    PreviewDrawingArea.Refresh()

End

Public Sub _unknown(...) As Variant
    
    If Not Object.IsValid($drawingArea) Then initializeWidgets()
    
    Return $drawingArea.GetProperty(Param.Name)
    
End

Public Sub _property(...) As Boolean
    
    ' has no unnamed method
    
    Return True
    
End

Private Function Mode_Read() As Integer

    Return ModeComboBox.Index

End
