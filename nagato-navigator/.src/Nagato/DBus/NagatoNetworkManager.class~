' Gambas class file

Create Static

Property Read DeviceCount As Integer

Private Const Service As String = "org.gambas.nagato.network.manager"
Private Const ObjectPath As String = "/org/nagato/network/manager"
Private Const Interface As String = "org.gambas.nagato.network.manager.nagatointerface"

Private $proxy As DBusProxy

Public Function GetSpeed(argDeviceIndex As Integer) As Float
    
    If argDeviceIndex > Me.DeviceCount - 1 Then Return 0
    
    Return $proxy.GetDeviceSpeed(argDeviceIndex)
    
Catch
    Return 0
    
End

Public Function GetDeviceTypeReadable(argDeviceIndex As Integer) As String
    
    Return $proxy.GetDeviceTypeReadable(argDeviceIndex)
    
Catch
    Return ""
    
End

Public Sub Activate()
    
    If Not DBus.Session.Applications.Exist(Service) Then
        Shell "nagato-network-manager --non-gui"
    Endif
    
End

Private Sub initializeProxy()
    
    $proxy = DBus[Service][ObjectPath, Interface]
    
End

Private Function DeviceCount_Read() As Integer

    If Not Object.IsValid($proxy) Then initializeProxy()

    Return $proxy.DeviceCount

Catch
    Return 0

End
